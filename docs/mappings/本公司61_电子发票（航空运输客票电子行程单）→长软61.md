# 本公司61_电子发票（航空运输客票电子行程单）→长软61 字段映射表

**文档版本**: v1.0
**创建日期**: 2025-12-30
**发票类型**: 61 - 电子发票（航空运输客票电子行程单）

---

## 📋 概述

本文档定义了本公司发票查验API与长软发票查验服务之间，针对"电子发票（航空运输客票电子行程单）"的完整字段映射关系。

- **本公司API**: invoice_verification.apifox.json (RESTful JSON格式)
- **长软API**: 【长软】发票查验服务调用说明V4.0.16.pdf (XML格式)
- **本公司发票类型代码**: 61
- **长软发票类型代码**: 61
- **长软文档章节**: 3.2.3.14

### 依赖的通用文档

本映射表引用以下通用文档，使用前请先了解：
- 📄 [00_通用说明_请求参数映射.md](./00_通用说明_请求参数映射.md) - 查验请求参数映射
- 📄 [00_通用说明_枚举映射.md](./00_通用说明_枚举映射.md) - 通用枚举值映射（CYJGDM, ZFBZ, TSPZBZ等）

---

## 一、类型映射关系

| 项目 | 本公司API | 长软API | 说明 |
|------|-----------|---------|------|
| 发票类型代码 | `61` | `61` | 完全一致 |
| 发票类型名称 | 电子发票（航空运输客票电子行程单） | 航空运输电子客票行程单 | |
| 数据结构定义 | `#/definitions/231697058` | `3.2.3.14` | |
| 数电发票类型 | - | - | 数电发票，发票号码20位 |

---

## 二、发票主信息字段映射

### 2.1 完整字段对照表

⚠️ **重要**: 本表格包含该发票类型的**所有响应字段**，请逐一核对。

| 本公司API字段路径 | 本公司API中文名 | 本公司API类型 | 长软API字段路径 | 长软API中文名 | 长软API类型 | 映射说明 |
|---|---|---|---|---|---|---|
| `invoice_code` | 发票代码 | string(12) | `BODY/FPDM` | 发票代码 | VARCHAR2(20) | **长软固定为空**，数电发票无发票代码 |
| `invoice_number` | 发票号码 | string(20) | `BODY/FPHM` | 发票号码 | VARCHAR2(20) | 直接映射，数电发票20位号码 |
| - | - | - | `BODY/CYCS` | 查验次数 | VARCHAR2(32) | **长软独有**，记录该发票被查验次数 |
| `issue_date` | 开票日期 | string(19) | `BODY/KPRQ` | 开票日期 | VARCHAR2(32) | 格式转换：YYYY-MM-DD ← YYYYMMDD |
| `buyer_tax_no` | 购买方纳税人识别号 | string(20) | `BODY/GFSBH` | 购买方纳税人识别号 | VARCHAR2(64) | 直接映射 |
| `buyer_name` | 购买方名称 | string(300) | `BODY/GFMC` | 购买方名称 | VARCHAR2(300) | 直接映射 |
| `total_tax_amount` | 合计税额 | number(18,2) | `BODY/SE` | 税额 | VARCHAR2(32) | 类型转换：number ↔ string |
| - | 价税合计（计算字段） | number(18,2) | `BODY/JSHJ` | 价税合计 | VARCHAR2(32) | 本公司可从total_amount+total_tax_amount计算 |
| `total_amount` | 合计金额（合计不含税金额） | number(18,2) | - | - | - | **本公司独有**，可从JSHJ-SE反推 |
| `amount_with_tax_in_words` | 价税合计（大写） | string(100) | - | - | - | **本公司独有**，数字大写转换 |
| - | - | - | `BODY/CYSJ` | 查验时间 | VARCHAR2(32) | **长软独有**，查验时间戳 |
| `is_paper_invoice` | 是否为纸质发票 | string(1) | - | - | - | **本公司独有**，数电航空客票为"0" |
| `original_blue_invoice_no` | 开具红字发票对应的蓝字发票号码 | string(30) | - | - | - | **本公司独有**，红字发票时使用 |
| `invoice_category_code` | 发票票种代码 | string(2) | - | - | - | **本公司独有**，业务系统提供 |
| `special_element_type_code` | 特定要素类型代码 | string(2) | - | - | - | **本公司独有**，航空客票为特定类型 |
| `buyer_address` | 购买方地址 | string(300) | - | - | - | **本公司独有**，长软不返回 |
| `buyer_phone` | 购买方联系电话 | string(60) | - | - | - | **本公司独有**，长软不返回 |
| `seller_tax_no` | 销售方纳税人识别号 | string(20) | - | - | - | **本公司独有**，从flight_specific_elements获取 |
| `seller_name` | 销售方名称 | string(300) | - | - | - | **本公司独有**，从flight_specific_elements获取 |
| `seller_address` | 销售方地址 | string(300) | - | - | - | **本公司独有**，长软不返回 |
| `seller_phone` | 销售方联系电话 | string(60) | - | - | - | **本公司独有**，长软不返回 |
| `buyer_agent_name` | 购买方经办人 | string(150) | - | - | - | **本公司独有**，长软不返回 |
| `agent_id_no` | 经办人身份证件号码 | string(30) | - | - | - | **本公司独有**，长软不返回 |
| `agent_telephone` | 经办人联系电话 | string(60) | - | - | - | **本公司独有**，长软不返回 |
| `agent_id_type_code` | 经办人身份证件种类 | string(30) | - | - | - | **本公司独有**，长软不返回 |
| `issuer` | 开票人 | string(300) | - | - | - | **本公司独有**，长软不返回 |
| `payee` | 收款人 | string(300) | - | - | - | **本公司独有**，长软不返回 |
| `remitter` | 付汇人 | string(300) | - | - | - | **本公司独有**，长软不返回 |
| `settlement_method_code` | 结算方式代码 | string(2) | - | - | - | **本公司独有**，长软不返回 |
| `issuer_real_name_auth_location` | 开票人实人认证地址信息 | string(100) | - | - | - | **本公司独有**，长软不返回 |
| `mobile_invoice_location` | 手机开票地址信息 | string(100) | - | - | - | **本公司独有**，长软不返回 |
| `contract_no` | 合同编号 | string(60) | - | - | - | **本公司独有**，长软不返回 |
| `tax_obligation_occurrence_time` | 纳税义务发生时间 | string(17) | - | - | - | **本公司独有**，长软不返回 |
| `is_blue_invoice` | 是否为蓝字发票 | object | - | - | - | **本公司独有**，引用#/definitions/231697050 |
| `vat_immediate_refund_code` | 增值税即征即退代码 | string(2) | - | - | - | **本公司独有**，长软不返回 |
| `remark` | 备注 | string(300) | - | - | - | **本公司独有**，长软不返回 |
| `goods_quantity` | 商品数量 | number(18,4) | - | - | - | **本公司独有**，长软不返回 |
| `export_tax_refund_type_code` | 出口退税类代码 | string(2) | - | - | - | **本公司独有**，长软不返回 |
| `invoice_status` | 发票状态 | object | `BODY/FPZT` | 发票状态 | VARCHAR2(12) | 枚举映射，详见通用枚举文档 |

**字段分类说明**：
- **直接映射**: 字段名和含义一致，直接对应
- **格式转换**: 需要进行格式转换（如日期、金额格式）
- **类型转换**: 需要进行数据类型转换（如string ↔ number）
- **长软独有**: 长软API独有字段，本公司API无此字段
- **本公司独有**: 本公司API独有字段，需从其他数据源获取或计算

### 2.2 本公司独有字段处理说明

| 本公司字段 | 数据来源 | 处理逻辑 |
|-----------|---------|----------|
| `invoice_code` | 固定值 | 数电发票无发票代码，本公司API可设为空字符串或null |
| `total_amount` | 计算得出 | 从JSHJ（价税合计）减去SE（税额）得出：total_amount = JSHJ - SE |
| `amount_with_tax_in_words` | 计算得出 | 将价税合计金额转换为中文大写 |
| `is_paper_invoice` | 固定值 | 数电发票固定为"0"（电子发票） |
| `seller_tax_no` | 特定要素 | 从flight_specific_elements.seller_tax_no获取 |
| `seller_name` | 特定要素 | 从flight_specific_elements.seller_name获取 |
| `is_blue_invoice` | 计算得出 | 根据original_blue_invoice_no是否为空判断，或从业务系统获取 |
| `invoice_status` | 枚举映射 | 从FPZT字段映射，详见第五章 |

---

## 三、货物/明细字段映射

### 3.1 明细结构说明

**本公司API路径**: `items[]`
**长软API路径**: 无传统货物明细结构

⚠️ **重要**: 航空客票没有传统的货物明细结构，本公司API的`items[]`字段用于存放通用的项目信息。

航空客票的主要明细信息存储在**民航行程单电子发票特定要素**中，包括：
- 乘客信息
- 航段信息（flight_segment_details）
- 票价、燃油附加费、民航发展基金等费用明细

### 3.2 完整明细字段对照表

**本公司API的items[]字段（通用项目信息）**：

| 本公司API字段 | 本公司API中文名 | 本公司API类型 | 长软API字段 | 长软API中文名 | 长软API类型 | 映射说明 |
|---|---|---|---|---|---|---|
| `sequence_no` | 序号 | integer | - | - | - | **本公司独有**，用于排序，可设为1 |
| `name` | 项目名称 | string(600) | - | - | - | **本公司独有**，可设为"航空运输服务" |
| `goods_or_service_name` | 货物或应税劳务、服务名称 | string(300) | - | - | - | **本公司独有**，可设为"航空运输服务" |
| `item_short_name` | 商品服务简称 | string(120) | - | - | - | **本公司独有**，可设为"航空运输" |
| `tax_classification_code` | 商品和服务税收分类合并编码 | string(19) | - | - | - | **本公司独有**，航空运输服务编码 |
| `amount` | 金额 | number(18,2) | - | - | - | **本公司独有**，可使用合计不含税金额 |
| `tax_rate` | 税率 | number(16,6) | - | - | - | **本公司独有**，计算得出：SE/total_amount |
| `tax_amount` | 税额 | number(18,6) | - | - | - | **本公司独有**，使用合计税额 |
| `deduction_amount` | 扣除额 | number(18,2) | - | - | - | **本公司独有**，航空客票通常为0 |

---

## 四、民航行程单特定要素字段映射

### 4.1 特定要素结构说明

**本公司API路径**: `flight_specific_elements`
**长软API路径**: `BODY/`（字段直接在BODY下）

航空客票的核心信息存储在特定要素中，包括乘客信息、票价费用、航段明细等。

### 4.2 特定要素主字段对照表

| 本公司API字段路径 | 本公司API中文名 | 本公司API类型 | 长软API字段路径 | 长软API中文名 | 长软API类型 | 映射说明 |
|---|---|---|---|---|---|---|
| `flight_specific_elements.invoice_number` | 发票号码 | string(30) | `BODY/FPHM` | 发票号码 | VARCHAR2(20) | 与主发票号码一致 |
| `flight_specific_elements.domestic_international_flag` | 国内国际标识 | string(1) | `BODY/GNGJBS` | 国内国际标识 | VARCHAR2(12) | 直接映射 |
| `flight_specific_elements.gp_no` | GP单号 | string(20) | `BODY/GP` | GP单号 | VARCHAR2(64) | 直接映射 |
| `flight_specific_elements.passenger_name` | 姓名 | string(49) | `BODY/XM` | 姓名 | VARCHAR2(120) | 直接映射，乘客姓名 |
| `flight_specific_elements.id_no` | 证件号码 | string(30) | `BODY/ZJH` | 证件号码 | VARCHAR2(120) | 直接映射，乘客证件号 |
| `flight_specific_elements.eticket_no` | 电子客票号码 | string(30) | `BODY/DZKPHM` | 电子客票号码 | VARCHAR2(32) | 直接映射 |
| `flight_specific_elements.fare` | 票价 | string | `BODY/PJ` | 票价 | VARCHAR2(32) | 类型转换：string ↔ number |
| `flight_specific_elements.fuel_surcharge` | 燃油附加费 | string | `BODY/RYFJF` | 燃油附加费 | VARCHAR2(32) | 类型转换：string ↔ number |
| `flight_specific_elements.civil_aviation_development_fund` | 民航发展基金 | string | `BODY/MHFZJJ` | 民航发展基金 | VARCHAR2(32) | 类型转换：string ↔ number |
| `flight_specific_elements.other_tax_and_fee` | 其他税费 | string | `BODY/QTSF` | 其他税费 | VARCHAR2(32) | 类型转换：string ↔ number |
| `flight_specific_elements.endorsement` | 签注 | string(200) | - | - | - | **本公司独有**，长软不返回 |
| `flight_specific_elements.verification_code` | 验证码 | string(20) | - | - | - | **本公司独有**，长软不返回 |
| `flight_specific_elements.tips` | 提示信息 | string(100) | - | - | - | **本公司独有**，长软不返回 |
| `flight_specific_elements.insurance_fee` | 保险费 | string(20) | - | - | - | **本公司独有**，长软不返回 |
| `flight_specific_elements.sales_outlet_code` | 销售网点代号 | string(20) | - | - | - | **本公司独有**，长软不返回 |
| `flight_specific_elements.issuing_unit` | 填开单位 | string(300) | - | - | - | **本公司独有**，长软不返回 |
| `flight_specific_elements.issue_date` | 开票日期 | string | - | - | - | **本公司独有**，使用主发票开票日期 |
| `flight_specific_elements.seller_name` | 销售方名称 | string(300) | - | - | - | **本公司独有**，长软不返回 |
| `flight_specific_elements.seller_tax_no` | 销售方纳税人识别号 | string(20) | - | - | - | **本公司独有**，长软不返回 |
| `flight_specific_elements.buyer_name` | 购买方名称 | string(300) | - | - | - | **本公司独有**，使用主发票购买方名称 |
| `flight_specific_elements.buyer_tax_no` | 购买方纳税人识别号 | string(20) | - | - | - | **本公司独有**，使用主发票购买方税号 |
| `flight_specific_elements.is_blue_invoice` | 是否为蓝字发票 | object | - | - | - | **本公司独有**，引用#/definitions/231697050 |

### 4.3 航段明细字段对照表

**本公司API路径**: `flight_specific_elements.flight_segment_details[]`
**长软API路径**: `BODY/CHILDLIST/CHILD[]`（货物信息节点）

| 本公司API字段 | 本公司API中文名 | 本公司API类型 | 长软API字段 | 长软API中文名 | 长软API类型 | 映射说明 |
|---|---|---|---|---|---|---|
| `departure_station` | 始发站 | string(50) | `SFZ` | 始发站 | VARCHAR2(64) | 直接映射 |
| `destination_station` | 目的站 | string(50) | `MDZ` | 目的站 | VARCHAR2(64) | 直接映射 |
| `segment` | 航段 | integer | `HD` | 航段 | VARCHAR2(2) | 类型转换：integer ↔ string |
| `carrier` | 承运人 | string(20) | `CYR` | 承运人 | VARCHAR2(64) | 直接映射 |
| `flight_no` | 航班号 | string(20) | `HBH` | 航班号 | VARCHAR2(16) | 直接映射 |
| `seat_class` | 座位等级 | string(20) | `ZWDJ` | 座位等级 | VARCHAR2(10) | 枚举映射，详见5.2节 |
| `carrier_date` | 承运日期 | string(8) | `CYRQ` | 承运日期 | VARCHAR2(32) | 格式转换：YYYYMMDD |
| `takeoff_time` | 起飞时间 | string(17) | `QFSJ` | 起飞时间 | VARCHAR2(32) | 格式转换：YYYY-MM-DD HH:mm:ss |
| `ticket_class_category` | 客票级别/客票类别 | string(20) | `KPJB` | 客票级别/客票类型 | VARCHAR2(20) | 直接映射 |
| `ticket_effective_date` | 客票生效日期 | string(8) | - | - | - | **本公司独有**，长软不返回 |
| `valid_until_date` | 有效截止日期 | string(8) | - | - | - | **本公司独有**，长软不返回 |
| `free_baggage_allowance` | 免费行李额 | string(20) | - | - | - | **本公司独有**，长软不返回 |

---

## 五、数据格式转换说明

### 5.1 日期格式转换

| API | 格式 | 示例 |
|-----|------|------|
| 本公司API - 开票日期 | `YYYY-MM-DD` 或 `YYYY-MM-DD HH:mm:ss` | 2025-12-30 或 2025-12-30 16:59:45 |
| 长软API - 开票日期 | `YYYYMMDD` | 20251230 |
| 本公司API - 承运日期 | `YYYYMMDD` | 20251230 |
| 长软API - 承运日期 | `YYYYMMDD` | 20251230 |
| 本公司API - 起飞时间 | `YYYY-MM-DD HH:mm:ss` | 2025-12-30 16:59:45 |
| 长软API - 起飞时间 | `VARCHAR2(32)` | 可能为YYYYMMDD HH:mm:ss或其他格式 |

**转换规则**：
1. **开票日期（KPRQ）**: `YYYYMMDD` → `YYYY-MM-DD`
2. **承运日期（CYRQ）**: 保持`YYYYMMDD`格式
3. **起飞时间（QFSJ）**: 根据长软返回格式进行解析转换

### 5.2 数值类型转换

| 数据项 | 本公司API | 长软API | 转换说明 |
|--------|-----------|---------|----------|
| 税额 | `number` (18,2) | `VARCHAR2(32)` 字符串 | 本公司→长软: `.toString()`<br>长软→本公司: `parseFloat()` |
| 价税合计 | `number` (18,2) | `VARCHAR2(32)` 字符串 | 同上 |
| 票价、燃油附加费等 | `string` | `VARCHAR2(32)` 字符串 | 本公司定义为string，直接映射 |
| 航段序号 | `integer` | `VARCHAR2(2)` 字符串 | 本公司→长软: `.toString()`<br>长软→本公司: `parseInt()` |

### 5.3 费用计算关系

航空客票的费用构成关系：

```
价税合计（JSHJ） = 票价（PJ） + 燃油附加费（RYFJF） + 民航发展基金（MHFZJJ） + 其他税费（QTSF）

不含税金额 = 价税合计（JSHJ） - 税额（SE）

税率 = 税额（SE） / 不含税金额
```

---

## 六、枚举值映射

### 6.1 通用枚举映射

通用枚举值详见: 📄 [00_通用说明_枚举映射.md](./00_通用说明_枚举映射.md)

包括：
- `FPZT` (发票状态) → `invoice_status`
- `CYJGDM` (查验结果代码) - 长软独有

### 6.2 航空客票特有枚举映射

⚠️ **重要**: 以下枚举为**航空客票类型特有**，不在通用枚举文档中。

#### 6.2.1 国内国际标识 (GNGJBS/domestic_international_flag)

| 长软值 | 含义 | 本公司映射 |
|-------|------|-----------|
| 0 | 国内 | `domestic_international_flag: "0"` |
| 1 | 国际 | `domestic_international_flag: "1"` |

#### 6.2.2 座位等级 (ZWDJ/seat_class)

| 长软值 | 含义 | 说明 |
|-------|------|------|
| F | 头等舱 | First Class |
| C | 商务舱 | Business Class |
| Y | 经济舱 | Economy Class |
| W | 超级经济舱 | Premium Economy |
| ... | 其他舱位代码 | 根据IATA标准 |

**映射说明**: 座位等级为IATA标准舱位代码，本公司API直接使用长软返回的代码值，不进行转换。

---

## 七、航空客票特殊性说明

### 7.1 该类型的独特特性

1. **数电发票特性**:
   - 发票号码为20位数字
   - 无发票代码（FPDM为空）
   - 无校验码

2. **乘客信息**:
   - 包含乘客姓名（XM）和证件号码（ZJH）
   - 购买方可能是企业（使用税号）或个人（使用证件号）

3. **航段信息结构**:
   - 不同于传统货物明细，使用航段明细（flight_segment_details）
   - 每个航段包含始发站、目的站、航班号、起飞时间等信息
   - 支持多航段行程（联程票）

4. **费用构成复杂**:
   - 票价（PJ）
   - 燃油附加费（RYFJF）
   - 民航发展基金（MHFZJJ）
   - 其他税费（QTSF）
   - 可能包含保险费（本公司独有）

5. **特殊标识字段**:
   - GP单号：用于航空公司内部管理
   - 电子客票号码（DZKPHM）
   - 国内国际标识（GNGJBS）

### 7.2 与其他类型的区别

| 特性 | 航空客票(61) | 增值税专票(01) | 铁路客票(51) |
|------|-------------|---------------|-------------|
| 发票代码 | 无（空） | 有12位 | 无（空） |
| 发票号码 | 20位数电 | 8位 | 20位数电 |
| 校验码 | 无 | 无 | 无 |
| 明细结构 | 航段明细 | 货物明细 | 无明细 |
| 乘客信息 | 有（姓名、证件号） | 无 | 有（姓名、证件号） |
| 特殊字段 | GP单号、电子客票号 | 密码区 | 车次、席位 |
| 购买方 | 企业或个人 | 通常为企业 | 通常为个人 |

### 7.3 特殊处理逻辑

#### 7.3.1 数据映射流程

1. **解析长软XML响应**:
   - 提取BODY节点下的主发票信息
   - 提取CHILDLIST/CHILD节点下的航段明细

2. **构建本公司JSON响应**:
   - 主发票字段直接映射到响应根节点
   - 航段明细映射到flight_specific_elements.flight_segment_details数组
   - 特定要素字段映射到flight_specific_elements对象

3. **计算派生字段**:
   - `total_amount` = JSHJ - SE
   - `tax_rate` = SE / total_amount（如需要）
   - `amount_with_tax_in_words` = 金额大写转换(JSHJ)

4. **填充固定值**:
   - `invoice_code` = null或空字符串
   - `is_paper_invoice` = "0"
   - `items[0].name` = "航空运输服务"（可选）

#### 7.3.2 特殊验证规则

1. **必填字段验证**:
   - 发票号码（20位数字）
   - 开票日期
   - 价税合计
   - 购买方名称

2. **业务逻辑验证**:
   - 费用计算公式验证：PJ + RYFJF + MHFZJJ + QTSF = JSHJ
   - 航段序号连续性验证
   - 日期合理性验证（承运日期、起飞时间）

3. **数据完整性**:
   - 至少包含一个航段信息
   - 乘客信息完整（姓名、证件号）

---

## 八、集成注意事项

### 8.1 必填字段对比

**长软API要求必填**（查验请求）:
- 发票号码（FPHM，20位数电发票号码）
- 开票日期（KPRQ）
- 价税合计（JSHJ）

**本公司API要求必填**（响应数据）:
- `seller_tax_no` - 销售方纳税人识别号
- `seller_name` - 销售方名称
- `buyer_name` - 购买方名称
- `is_blue_invoice` - 是否为蓝字发票
- `invoice_status` - 发票状态

### 8.2 字段长度差异

| 字段 | 本公司长度 | 长软长度 | 实际风险评估 |
|------|-----------|---------|------------|
| invoice_number | 20 | 20 | ✅ 长度一致，数电发票20位 |
| passenger_name | 49 | 120 | ⚠️ 本公司长度较小，中文姓名通常不超过10字符（30字节），但外文姓名可能较长 |
| buyer_tax_no | 20 | 64 | ✅ 中国税号最长20位，本公司长度足够 |
| seller_tax_no | 20 | - | ✅ 长软不返回此字段 |
| departure_station | 50 | 64 | ✅ 本公司长度足够，机场代码通常3-4位 |
| destination_station | 50 | 64 | ✅ 本公司长度足够 |

### 8.3 数据完整性

**长软独有字段**（本公司API无对应）:
- `CYCS` (查验次数) - 长软统计查验次数
- `CYSJ` (查验时间) - 长软查验时间戳

**本公司独有字段**（需从其他数据源获取或计算）:
- `total_amount` (合计不含税金额) - 从JSHJ-SE计算得出
- `amount_with_tax_in_words` (价税合计大写) - 从JSHJ转换
- `is_paper_invoice` (是否为纸质发票) - 固定为"0"
- `seller_tax_no`, `seller_name` - 从业务系统或特定要素获取
- 大部分特定要素字段（endorsement, verification_code, tips等） - 长软不返回，需从业务系统获取
- 航段的ticket_effective_date、valid_until_date、free_baggage_allowance - 长软不返回

### 8.4 航空客票特殊集成要点

⚠️ **这是最重要的部分，必须根据业务特性详细说明！**

#### 8.4.1 数据映射关键点

1. **特定要素映射**:
   - 长软将航空客票特定信息直接放在BODY节点下（如XM、ZJH、PJ等）
   - 本公司需将这些字段映射到flight_specific_elements对象中
   - 航段信息从CHILDLIST/CHILD映射到flight_specific_elements.flight_segment_details数组

2. **费用计算验证**:
   - 必须验证：PJ + RYFJF + MHFZJJ + QTSF = JSHJ
   - 如果不相等，需记录警告日志
   - 计算不含税金额：total_amount = JSHJ - SE

3. **日期时间处理**:
   - 开票日期：YYYYMMDD → YYYY-MM-DD
   - 承运日期：保持YYYYMMDD格式
   - 起飞时间：需根据长软实际返回格式进行解析

4. **缺失字段处理**:
   - 长软不返回seller_tax_no和seller_name，需从业务系统维护的航空公司信息库获取
   - 或者在特定要素中查找（但长软文档显示特定要素中也不返回）

#### 8.4.2 错误处理建议

1. **数据验证失败**:
   - 费用计算不匹配：记录警告，继续处理
   - 必填字段缺失：返回错误
   - 日期格式错误：尝试多种格式解析，失败则返回错误

2. **数据转换异常**:
   - 金额转换失败：设为0并记录错误
   - 日期转换失败：保留原始字符串并记录警告
   - 航段序号转换失败：设为0并记录警告

3. **业务规则验证**:
   - 航段信息为空：返回错误（航空客票必须有航段）
   - 乘客信息缺失：记录警告（可能是企业报销场景）

#### 8.4.3 性能优化建议

1. **XML解析优化**:
   - 使用流式解析器处理大量航段数据
   - 避免重复解析同一XML文档

2. **字段映射缓存**:
   - 航空公司信息（税号、名称）可缓存
   - 座位等级枚举可预加载

3. **并发处理**:
   - 主发票信息和航段明细可并行映射
   - 多张航空客票查验可批量处理

#### 8.4.4 测试要点

1. **正常场景**:
   - 单航段国内航班
   - 多航段联程票（国内）
   - 国际航班

2. **边界场景**:
   - 航段数量为1
   - 航段数量较多（如5个以上）
   - 费用项为0（如无燃油附加费）
   - 外文乘客姓名（长度测试）

3. **异常场景**:
   - 费用计算不匹配
   - 航段信息缺失
   - 日期格式异常
   - 必填字段为空

**文档结束**
