# 本公司14_增值税普通发票（通行费）→长软14 字段映射表

**文档版本**: v1.0
**创建日期**: 2025-12-30
**发票类型**: 14 - 增值税普通发票（通行费）

---

## 📋 概述

本文档定义了本公司发票查验API与长软发票查验服务之间，针对"增值税普通发票（通行费）"的完整字段映射关系。

- **本公司API**: [`/partners/invoice-verifications`](https://s.apifox.cn/2795ad32-31e7-4363-8294-578e8dc6202c/395314528e0) (RESTful JSON格式)
- **长软API**: 【长软】发票查验服务调用说明V4.0.16.pdf (XML格式)
- **本公司发票类型代码**: 14
- **长软发票类型代码**: 14
- **长软文档章节**: 3.2.3.6

### 依赖的通用文档

本映射表引用以下通用文档，使用前请先了解：
- 📄 [00_通用说明_请求参数映射.md](./00_通用说明_请求参数映射.md) - 查验请求参数映射
- 📄 [00_通用说明_枚举映射.md](./00_通用说明_枚举映射.md) - 通用枚举值映射（CYJGDM, ZFBZ, TSPZBZ等）

---

## 一、类型映射关系

| 项目 | 本公司API | 长软API | 说明 |
|------|-----------|---------|------|
| 发票类型代码 | `14` | `14` | 完全一致 |
| 发票类型名称 | 增值税普通发票（通行费） | 增值税普通发票（通行费） | |
| 数据结构定义 | `#/definitions/231697055` | `3.2.3.6` | |
| 数电发票类型 | - | - | 非数电发票 |

---

## 二、发票主信息字段映射

### 2.1 完整字段对照表

⚠️ **重要**: 本表格包含该发票类型的**所有响应字段**，请逐一核对。

| 本公司API字段路径 | 本公司API中文名 | 本公司API类型 | 长软API字段路径 | 长软API中文名 | 长软API类型 | 映射说明 |
|---|---|---|---|---|---|---|
| `invoice_code` | 发票代码 | string(12) | `BODY/FPDM` | 发票代码 | VARCHAR2(20) | 直接映射 |
| `invoice_number` | 发票号码 | string(20) | `BODY/FPHM` | 发票号码 | VARCHAR2(10) | 直接映射，本公司支持更长 |
| - | - | - | `BODY/CYCS` | 查验次数 | VARCHAR2(32) | **长软独有**，记录该发票被查验次数 |
| `issue_date` | 开票日期 | string(19) | `BODY/KPRQ` | 开票日期 | VARCHAR2(32) | 格式转换：YYYY-MM-DD ← YYYYMMDD |
| `seller_name` | 销售方名称 | string(300) | `BODY/XFMC` | 销方名称 | VARCHAR2(300) | 直接映射 |
| `seller_tax_no` | 销售方识别号 | string(20) | `BODY/XFSH` | 销方纳税人识别号 | VARCHAR2(64) | 直接映射，注意长软字段名为XFSH |
| `seller_address_phone` | 销售方地址电话 | string(190) | `BODY/XFDZDH` | 销方地址电话 | VARCHAR2(120) | 直接映射 |
| `seller_bank_account` | 销售方银行账号 | string(300) | `BODY/XFYHZH` | 销方开户行及账号 | VARCHAR2(120) | 直接映射 |
| `buyer_name` | 购买方名称 | string(300) | `BODY/GFMC` | 购方名称 | VARCHAR2(300) | 直接映射 |
| `buyer_tax_no` | 购买方税号 | string(20) | `BODY/GFSH` | 购方纳税人识别号 | VARCHAR2(64) | 直接映射，注意长软字段名为GFSH |
| `buyer_address_phone` | 购买方地址电话 | string(190) | `BODY/GFDZDH` | 购方地址、电话 | VARCHAR2(120) | 直接映射 |
| `buyer_bank_account` | 购买方银行账号 | string(300) | `BODY/GFYHZH` | 购方开户行及账号 | VARCHAR2(120) | 直接映射 |
| `verification_code` | 校验码 | string(32) | `BODY/JYM` | 校验码 | VARCHAR2(32) | 直接映射 |
| `tax_amount` | 合计税额 | number(18,2) | `BODY/SE` | 税额 | VARCHAR2(32) | 类型转换：长软为字符串 |
| `amount_including_tax` | 价税合计 | number(18,2) | `BODY/JSHJ` | 价税合计 | VARCHAR2(32) | 类型转换：长软为字符串 |
| `remark` | 备注 | string(610) | `BODY/BZ` | 备注 | VARCHAR2(610) | 直接映射 |
| - | - | - | `BODY/SBBH` | 设备编号 | VARCHAR2(16) | **长软独有**，税控设备编号 |
| `amount_excluding_tax` | 合计金额(不含税) | number(18,2) | `BODY/JE` | 金额 | VARCHAR2(32) | 类型转换：长软为字符串 |
| `invoice_status_flag` | 发票状态标志 | 枚举 | `BODY/ZFBZ` | 作废标志 | CHAR(1) | 枚举映射：参见通用枚举文档 |
| - | - | - | `BODY/TXFBZ` | 通行费标志 | VARCHAR2(2) | **长软独有**，Y=显示通行费标志，N=不显示 |
| - | - | - | `BODY/CYSJ` | 查验时间 | VARCHAR2(20) | **长软独有**，查验时间戳 |
| `invoice_status` | 发票状态 | 枚举 | `HEAD/CYJGDM` | 查验结果代码 | VARCHAR(3) | **关键字段**，查验状态码，参见通用枚举文档 |
| `tax_payer_id` | 报税纳税人识别号 | string(20) | - | - | - | **本公司独有**，从业务系统获取 |
| `special_invoice_type` | 特殊票种 | 枚举("06","07") | - | - | - | **本公司独有**，06=可抵扣，07=不可抵扣 |
| `tax_control_code` | 税控码 | string(200) | - | - | - | **本公司独有**，从业务系统获取 |
| `proxy_seller_tax_no` | 代开发票真实销售方识别号 | string(20) | - | - | - | **本公司独有**，从业务规则解析 |
| `proxy_seller_name` | 代开发票真实销售方名称 | string(300) | - | - | - | **本公司独有**，从业务规则解析 |
| `taxation_voucher` | 完税凭证号 | string(200) | - | - | - | **本公司独有**，通行费发票特有字段 |
| `void_date` | 作废日期 | string(19) | - | - | - | **本公司独有**，从业务系统获取 |
| `tax_rate` | 税率 | number(8,5) | - | - | - | **本公司独有**，从items明细中计算得出 |
| `non_taxable_amount` | 不征税金额 | number(18,2) | - | - | - | **本公司独有**，从业务系统获取 |

**字段分类说明**：
- **直接映射**: 字段名和含义一致，直接对应
- **格式转换**: 需要进行格式转换（如日期、金额格式）
- **类型转换**: 需要进行数据类型转换（如string ↔ number）
- **长软独有**: 长软API独有字段，本公司API无此字段
- **本公司独有**: 本公司API独有字段，需从其他数据源获取或计算

### 2.2 本公司独有字段处理说明

| 本公司字段 | 数据来源 | 处理逻辑 |
|-----------|---------|----------|
| `tax_payer_id` | 业务系统 | 报税纳税人识别号，从企业业务系统获取 |
| `special_invoice_type` | 业务规则 | 通行费发票特殊分类，06=可抵扣，07=不可抵扣 |
| `tax_control_code` | 业务系统 | 税控码，从业务系统获取 |
| `proxy_seller_tax_no` | 解析得出 | 代开发票真实销售方识别号 |
| `proxy_seller_name` | 解析得出 | 代开发票真实销售方名称 |
| `taxation_voucher` | 业务系统 | 完税凭证号，通行费发票可能需要 |
| `void_date` | 业务系统 | 作废日期，从企业业务系统获取 |
| `tax_rate` | 计算得出 | 取items中第一个非零税率，或计算加权平均税率 |
| `non_taxable_amount` | 业务系统 | 不征税金额 |

---

## 三、货物/明细字段映射

### 3.1 明细结构说明

**本公司API路径**: `items[]`
**长软API路径**: `BODY/CHILDLIST/CHILD[]`

⚠️ **注意**:
- ✅ **增值税普通发票（通行费）有货物明细结构**
- 🔄 **明细字段含义特殊**：通行费发票的明细字段被重新定义用于记录通行信息

### 3.2 完整明细字段对照表

⚠️ **特别说明**: 通行费发票的明细字段具有**特殊含义**，不同于常规货物发票。

| 本公司API字段 | 本公司API中文名 | 本公司API类型 | 长软API字段 | 长软API中文名 | 长软API类型 | 映射说明 |
|---|---|---|---|---|---|---|
| `sequence_no` | 货物明细序号 | integer | - | - | - | **本公司独有**，用于排序 |
| `name` | 货物名称 | string(310) | `HWMC` | 货物或应税劳务、服务名称 | VARCHAR2(310) | 直接映射，通常为"通行费" |
| `specification` | 规格型号 | string(64) | `CPH` | **车牌号** | VARCHAR2(64) | **特殊映射**：字段重用为车牌号 |
| `unit` | 计量单位 | string(52) | `LX` | **类型** | VARCHAR2(52) | **特殊映射**：字段重用为通行类型（如高速公路、桥梁） |
| `quantity` | 数量 | string(25) | `TXRQQ` | **通行日期起** | VARCHAR2(32) | **特殊映射**：字段重用为通行开始日期 |
| `unit_price` | 单价 | string(25) | `TXRQZ` | **通行日期止** | VARCHAR2(32) | **特殊映射**：字段重用为通行结束日期 |
| `amount` | 金额 | number(18,2) | `JE` | 金额 | VARCHAR2(32) | 类型转换：长软为字符串 |
| `tax_rate` | 税率 | number(8,5) | `SLV` | 税率 | VARCHAR2(32) | 类型转换：长软为字符串 |
| `tax_amount` | 税额 | number(18,2) | `SE` | 税额 | VARCHAR2(32) | 类型转换：长软为字符串 |
| `product_code` | 商品编码 | string(45) | - | - | - | **本公司独有**，商品和服务税收分类编码 |
| - | - | - | `TSZCBS` | 特殊政策标识 | VARCHAR2(2) | **长软独有**，参看附录1码表 |
| - | - | - | `SJSL` | 实际税率 | VARCHAR2(32) | **长软独有**，可能与标准税率不同 |
| - | - | - | `SJSE` | 实际税额 | VARCHAR2(32) | **长软独有**，可能与计算税额不同 |

**说明**：
- 通行费发票的明细字段被重新定义用于记录通行信息
- `specification` → `CPH` (车牌号)
- `unit` → `LX` (类型：如"高速公路"、"桥梁"等)
- `quantity` → `TXRQQ` (通行日期起)
- `unit_price` → `TXRQZ` (通行日期止)

---

## 四、数据格式转换说明

### 4.1 日期格式转换

| API | 格式 | 示例 |
|-----|------|------|
| 本公司API | `YYYY-MM-DD` 或 `YYYY-MM-DD HH:mm:ss` | 2025-12-30 或 2025-12-30 16:59:45 |
| 长软API | `YYYYMMDD` | 20251230 |

**转换规则**：
- 开票日期 (KPRQ): `YYYYMMDD` → `YYYY-MM-DD`
- 通行日期起/止 (TXRQQ/TXRQZ): 长软格式可能为 `YYYYMMDD` 或 `YYYY-MM-DD`，需要统一转换

### 4.2 数值类型转换

| 数据项 | 本公司API | 长软API | 转换说明 |
|--------|-----------|---------|----------|
| 金额 | `number` (18,2) | `VARCHAR2(32)` 字符串 | 长软→本公司: `parseFloat()` |
| 税额 | `number` (18,2) | `VARCHAR2(32)` 字符串 | 长软→本公司: `parseFloat()` |
| 价税合计 | `number` (18,2) | `VARCHAR2(32)` 字符串 | 长软→本公司: `parseFloat()` |
| 税率 | `number` (8,5) | `VARCHAR2(32)` 字符串 | 长软→本公司: `parseFloat()` |
| 实际税率 | - | `VARCHAR2(32)` 字符串 | 长软独有字段 |
| 实际税额 | - | `VARCHAR2(32)` 字符串 | 长软独有字段 |

### 4.3 字符串长度适配

| 字段 | 本公司长度 | 长软长度 | 处理策略 |
|------|-----------|---------|----------|
| invoice_number | 20 | 10 | ⚠️ 本公司更宽松，兼容数电发票20位 |
| seller_tax_no | 20 | 64 | ⚠️ 长软更宽松，但实际18位够用 |
| buyer_tax_no | 20 | 64 | ⚠️ 长软更宽松，但实际18位够用 |
| seller_address_phone | 190 | 120 | ⚠️ 本公司更宽松，但实际可能截断 |
| buyer_address_phone | 190 | 120 | ⚠️ 本公司更宽松，但实际可能截断 |

---

## 五、枚举值映射

### 5.1 通用枚举映射

通用枚举值详见: 📄 [00_通用说明_枚举映射.md](./00_通用说明_枚举映射.md)

包括：
- **查验结果代码** (CYJGDM → HTTP状态码 + error.code)
- **作废标志** (ZFBZ → invoice_status_flag)

### 5.2 通行费发票特有枚举映射

⚠️ **重要**: 以下枚举为**该发票类型特有**，不在通用枚举文档中。

#### 5.2.1 通行费标志 (TXFBZ)

| 长软值 | 含义 | 说明 |
|-------|------|------|
| Y | 显示通行费标志 | 该发票属于通行费发票 |
| N | 不显示通行费标志 | 该发票不属于通行费发票 |

**说明**：本公司API暂无对应字段，可扩展时添加 `toll_flag` 字段。

#### 5.2.2 特殊票种 (special_invoice_type)

**本公司API特有枚举**：

| 本公司值 | 含义 | 说明 |
|---------|------|------|
| 06 | 通行费（可抵扣） | 可以抵扣进项税额的通行费发票 |
| 07 | 通行费（不可抵扣） | 不可抵扣进项税额的通行费发票 |

**说明**：
- 该枚举为本公司API独有，长软API无对应字段
- 需要从业务规则或发票明细中的 `TSZCBS`（特殊政策标识）判断

#### 5.2.3 特殊政策标识 (TSZCBS)

**长软API独有枚举**：

| 长软值 | 含义 | 本公司映射建议 |
|-------|------|--------------|
| 1 | 免税 | 可映射到 special_invoice_type="07"（不可抵扣） |
| 2 | 不征税 | 可映射到 special_invoice_type="07"（不可抵扣） |
| 3 | 0税率 | 可映射到 special_invoice_type="06"（可抵扣） |
| 01 | 不征税 | 可映射到 special_invoice_type="07"（不可抵扣） |

**说明**：
- TSZCBS 是明细级字段，每个明细都可能有不同的标识
- 需要综合判断所有明细的标识，决定整张发票的 `special_invoice_type`

---

## 六、通行费发票特殊性说明

### 6.1 该类型的独特特性

1. **明细字段重用**
   - 通行费发票将常规发票的明细字段重新定义为通行相关信息
   - `specification` (规格型号) → 车牌号
   - `unit` (计量单位) → 通行类型
   - `quantity` (数量) → 通行日期起
   - `unit_price` (单价) → 通行日期止

2. **抵扣政策差异**
   - 通行费发票分为可抵扣和不可抵扣两种
   - 本公司API使用 `special_invoice_type` 字段区分：06=可抵扣，07=不可抵扣
   - 2018年1月1日起，部分通行费可以抵扣进项税额
   - 电子发票（左上角有"通行费"字样）可抵扣，纸质发票不可抵扣

3. **完税凭证号**
   - 通行费发票可能包含 `taxation_voucher`（完税凭证号）字段
   - 该字段为本公司API独有，长软API无对应字段
   - 用于关联税款完税证明

4. **通行费标志**
   - 长软API有 `TXFBZ`（通行费标志）字段
   - Y=显示通行费标志，N=不显示通行费标志
   - 本公司API暂无对应字段

5. **实际税率与税额**
   - 长软API明细中有 `SJSL`（实际税率）和 `SJSE`（实际税额）
   - 可能与标准税率 `SLV` 和税额 `SE` 不同
   - 本公司API暂无对应字段

6. **校验码**
   - 通行费发票是增值税普通发票的一种，**有校验码**
   - 查验时需要提供校验码后六位

### 6.2 与其他类型的区别

| 特性 | 通行费发票(14) | 增值税普通发票(04) | 增值税专用发票(01) | 卷式发票(11) |
|------|--------------|------------------|------------------|-------------|
| 校验码 | ✅ 有 | ✅ 有 | ❌ 无 | ✅ 有 |
| 抵扣 | ⚠️ 部分可抵扣 | ❌ 不可抵扣 | ✅ 可抵扣 | ❌ 不可抵扣 |
| 明细结构 | ✅ 有（特殊含义） | ✅ 有货物明细 | ✅ 有货物明细 | ❌ 无明细 |
| 购方完整信息 | ✅ 必需 | ⚠️ 可选 | ✅ 必需 | ⚠️ 可选 |
| 销方完整信息 | ✅ 必需 | ✅ 必需 | ✅ 必需 | ✅ 必需 |
| 特殊处理 | 明细字段重用 | 无 | 农产品收购反向 | 无明细 |
| 发票介质 | 纸质/电子 | 纸质/电子 | 纸质 | 纸质（卷式） |
| 特殊字段 | 完税凭证号、通行费标志 | 无 | 无 | 收款员 |

### 6.3 特殊处理逻辑

#### 6.3.1 明细字段映射

通行费发票的明细字段需要特殊处理，因为字段含义与常规发票不同：

**常规发票明细字段**：
- `specification` = 规格型号（如"500ml"）
- `unit` = 计量单位（如"瓶"）
- `quantity` = 数量（如"100"）
- `unit_price` = 单价（如"5.00"）

**通行费发票明细字段**：
- `specification` = 车牌号（如"京A12345"）
- `unit` = 通行类型（如"高速公路"）
- `quantity` = 通行日期起（如"2025-12-01"）
- `unit_price` = 通行日期止（如"2025-12-30"）

**映射逻辑**：
```javascript
// 长软 → 本公司
function mapTollInvoiceItem(child) {
  return {
    sequence_no: calculateSequenceNo(),  // 计算序号
    name: child.HWMC,                    // 货物名称（通常为"通行费"）
    specification: child.CPH,            // 车牌号
    unit: child.LX,                      // 通行类型
    quantity: child.TXRQQ,               // 通行日期起
    unit_price: child.TXRQZ,             // 通行日期止
    amount: parseFloat(child.JE),        // 金额
    tax_rate: parseFloat(child.SLV),     // 税率
    tax_amount: parseFloat(child.SE),    // 税额
    product_code: null                   // 商品编码（本公司独有）
  };
}
```

#### 6.3.2 抵扣类型判断

根据发票信息判断是否可抵扣：

**判断逻辑**：
1. 检查明细中的 `TSZCBS`（特殊政策标识）
2. 如果所有明细都是免税(1)或不征税(2/01)，则为不可抵扣（special_invoice_type="07"）
3. 如果有明细是0税率(3)或正常税率，则为可抵扣（special_invoice_type="06"）
4. 电子通行费发票通常可抵扣，纸质通行费发票通常不可抵扣

#### 6.3.3 金额计算验证

通行费发票的金额计算与常规发票相同：
```
价税合计 = 金额 + 税额
税额 = Σ(明细金额 × 明细税率)
金额 = Σ(明细金额)
```

**注意事项**：
- 如果明细中有 `SJSL`（实际税率）和 `SJSE`（实际税额），应使用实际值
- 允许±0.02元的浮点数计算误差

#### 6.3.4 通行日期解析

通行日期字段可能有多种格式：
- `YYYYMMDD` 格式：20251201
- `YYYY-MM-DD` 格式：2025-12-01
- `YYYY/MM/DD` 格式：2025/12/01

需要统一转换为本公司API的标准格式 `YYYY-MM-DD`。

---

## 七、集成注意事项

### 7.1 必填字段对比

**查验请求必填字段**（税务总局查验平台）:
- 发票代码 (`invoice_code`)
- 发票号码 (`invoice_number`)
- 开票日期 (`issue_date`)
- 校验码后六位 (`verification_code` 后6位)

**查验请求必填字段**（乐企查验接口）:
- 发票代码 (`invoice_code`)
- 发票号码 (`invoice_number`)
- 开票日期 (`issue_date`)
- 校验码后六位 (`verification_code` 后6位)
- 税号 (`tax_payer_id`)

**本公司API响应必填字段**:
- `invoice_code` (发票代码)
- `invoice_number` (发票号码)
- `invoice_status` (发票状态)
- `seller_tax_no` (销售方识别号)

### 7.2 字段长度差异

| 字段 | 本公司长度 | 长软长度 | 实际风险评估 |
|------|-----------|---------|------------|
| invoice_number | 20 | 10 | ✅ 本公司长度更大，兼容数电票号 |
| seller_tax_no | 20 | 64 | ⚠️ 长软更大，但中国税号18位，20位足够 |
| buyer_tax_no | 20 | 64 | ⚠️ 长软更大，但中国税号18位，20位足够 |
| seller_address_phone | 190 | 120 | ⚠️ 本公司更大，可能超长 |
| buyer_address_phone | 190 | 120 | ⚠️ 本公司更大，可能超长 |
| seller_bank_account | 300 | 120 | ⚠️ 本公司更大，可能超长 |
| buyer_bank_account | 300 | 120 | ⚠️ 本公司更大，可能超长 |

### 7.3 数据完整性

**长软独有字段**（本公司API无对应）:
- `CYCS` (查验次数) - 长软统计查验次数，可记录但不返回
- `CYSJ` (查验时间) - 长软查验时间戳，可记录但不返回
- `SBBH` (设备编号) - 税控设备编号，可扩展字段支持
- `TXFBZ` (通行费标志) - 是否显示通行费标志，可扩展字段支持
- `TSZCBS` (特殊政策标识) - 明细级特殊政策标识，需用于判断抵扣类型
- `SJSL` (实际税率) - 明细级实际税率，可扩展字段支持
- `SJSE` (实际税额) - 明细级实际税额，可扩展字段支持

**本公司独有字段**（需从其他数据源获取）:
- `tax_payer_id` (报税纳税人识别号) - 从业务系统获取
- `special_invoice_type` (特殊票种) - 从业务规则判断（06可抵扣/07不可抵扣）
- `tax_control_code` (税控码) - 从业务系统获取
- `proxy_seller_tax_no` (代开发票真实销售方识别号) - 从业务规则解析
- `proxy_seller_name` (代开发票真实销售方名称) - 从业务规则解析
- `taxation_voucher` (完税凭证号) - 从业务系统获取
- `void_date` (作废日期) - 从业务系统获取
- `tax_rate` (主税率) - 从明细计算得出
- `non_taxable_amount` (不征税金额) - 从业务系统获取
- `product_code` (商品编码) - 明细级字段，从业务系统获取

### 7.4 通行费发票特殊集成要点

⚠️ **这是最重要的部分，必须根据业务特性详细说明！**

#### 7.4.1 明细字段的特殊含义处理

**挑战**：通行费发票的明细字段被重新定义，含义与常规发票完全不同。

**解决方案**：
1. 识别发票类型为14时，使用特殊的明细映射逻辑
2. 明确告知调用方字段的实际含义：
   - `specification` → 车牌号（而非规格型号）
   - `unit` → 通行类型（而非计量单位）
   - `quantity` → 通行日期起（而非数量）
   - `unit_price` → 通行日期止（而非单价）
3. 在API文档中清晰说明字段重用情况
4. 考虑为通行费发票创建专门的数据结构，避免字段重用导致的混淆

**建议扩展方案**：
为通行费发票创建专门的明细结构：
```json
{
  "toll_items": [
    {
      "sequence_no": 1,
      "vehicle_plate": "京A12345",         // 车牌号
      "toll_type": "高速公路",             // 通行类型
      "start_date": "2025-12-01",         // 通行日期起
      "end_date": "2025-12-30",           // 通行日期止
      "amount": 100.00,
      "tax_rate": 0.03,
      "tax_amount": 3.00
    }
  ]
}
```

#### 7.4.2 抵扣类型判断逻辑

**挑战**：需要判断通行费发票是否可抵扣。

**解决方案**：
1. **优先使用业务规则**：
   - 电子通行费发票（左上角标注"通行费"字样）→ 可抵扣
   - 纸质通行费发票 → 不可抵扣

2. **参考长软API字段**：
   - 检查 `TXFBZ` (通行费标志)：Y=通行费发票
   - 检查明细中的 `TSZCBS` (特殊政策标识)
   - 如果所有明细都是免税(1)或不征税(2/01) → 不可抵扣
   - 如果有明细是0税率(3)或正常税率 → 可抵扣

3. **设置默认值**：
   - 如果无法确定，默认设为不可抵扣（special_invoice_type="07"）
   - 由业务系统进一步判断

#### 7.4.3 通行日期格式统一

**挑战**：通行日期起/止字段可能有多种格式。

**解决方案**：
1. 检测日期格式：
   - 8位纯数字 → YYYYMMDD
   - 包含"-" → YYYY-MM-DD
   - 包含"/" → YYYY/MM/DD

2. 统一转换为 YYYY-MM-DD 格式

3. 验证日期合法性：
   - 通行日期起 <= 通行日期止
   - 通行日期 <= 开票日期

#### 7.4.4 完税凭证号处理

**挑战**：本公司API有 `taxation_voucher`（完税凭证号）字段，但长软API无对应字段。

**解决方案**：
1. 该字段需要从企业业务系统获取
2. 或者从发票备注字段中解析
3. 如果无法获取，设为 null 或空字符串

#### 7.4.5 实际税率与税额处理

**挑战**：长软API中有 `SJSL`（实际税率）和 `SJSE`（实际税额），可能与标准税率不同。

**解决方案**：
1. 优先使用实际税率和实际税额（如果存在）
2. 如果实际税率为空，使用标准税率 `SLV`
3. 如果实际税额为空，使用标准税额 `SE`
4. 验证实际税额是否等于 金额 × 实际税率（允许±0.02误差）

---

## 参考文档

1. 本公司API定义: [`/partners/invoice-verifications`](https://s.apifox.cn/2795ad32-31e7-4363-8294-578e8dc6202c/395314528e0) (Definition ID: 231697055)
2. 长软API文档: `【长软】发票查验服务调用说明V4.0.16.pdf` (章节3.2.3.6，第35-36页)
3. 通用枚举映射: `00_通用说明_枚举映射.md`
4. 通用请求参数映射: `00_通用说明_请求参数映射.md`
5. 国家税务总局发票查验平台: https://inv-veri.chinatax.gov.cn/
6. 国家税务总局关于收费公路通行费增值税电子普通发票开具等有关事项的公告（2017年第30号）

---

**文档结束**
