# {发票代码}-{发票名称} 字段映射表

**文档版本**: v1.0
**创建日期**: {YYYY-MM-DD}
**发票类型**: {发票代码} - {发票名称}

## 概述

本文档定义了本公司发票查验API与长软发票查验服务之间，针对"{发票代码}-{发票名称}"的字段映射关系。

- **本公司API**: invoice_verification.apifox.json (RESTful JSON格式)
- **长软API**: 【长软】发票查验服务调用说明V4.0.16.pdf (XML格式)

---

## 一、发票主信息字段映射

### 本公司API路径: (根据具体发票类型填写)
### 长软API路径: `BODY`

| 本公司API字段路径 | 本公司API中文名 | 本公司API类型 | 长软API字段路径 | 长软API中文名 | 长软API类型 | 映射说明 |
|---|---|---|---|---|---|---|
| `invoice_code` | 发票代码 | string(12) | `BODY/FPDM` | 发票代码 | VARCHAR2(20) | 直接映射 |
| `invoice_number` | 发票号码 | string(20) | `BODY/FPHM` | 发票号码 | VARCHAR2(10) | 直接映射 |
| `issue_date` | 开票日期 | string(19) | `BODY/KPRQ` | 开票日期 | VARCHAR2(32) | 格式转换：本公司YYYY-MM-DD，长软YYYYMMDD |
| - | - | - | `BODY/CYCS` | 查验次数 | VARCHAR2(32) | **长软独有**，记录该发票被查验次数 |
| {字段名} | {中文名} | {类型} | `BODY/{字段名}` | {中文名} | {类型} | {映射说明} |
| ... | ... | ... | ... | ... | ... | ... |

**说明**：
- ⚠️ 请根据长软PDF文档第3.2.3.X节补充完整的字段列表
- 标注长软独有字段和本公司独有字段

---

## 二、{明细结构名称}字段映射

> **注意**：
> - 如果该发票类型**有货物明细**（如01、04、10），使用"货物明细字段映射"
> - 如果该发票类型**无货物明细**（如03机动车），改为"车辆信息字段映射"或删除本章节
> - 如果该发票类型**有特殊明细结构**，根据实际情况调整章节标题

### 本公司API路径: `items[]` (或其他路径)
### 长软API路径: `BODY/CHILDLIST/CHILD[]` (或其他路径)

| 本公司API字段 | 本公司API中文名 | 本公司API类型 | 长软API字段 | 长软API中文名 | 长软API类型 | 映射说明 |
|---|---|---|---|---|---|---|
| `name` | 货物名称 | string(310) | `HWMC` | 货物或应税劳务名称 | VARCHAR2(320) | 直接映射 |
| {字段名} | {中文名} | {类型} | {字段名} | {中文名} | {类型} | {映射说明} |
| ... | ... | ... | ... | ... | ... | ... |

**说明**：
- ⚠️ 请根据长软PDF文档补充完整的明细字段列表
- 如果该发票类型无明细，请删除本章节

---

## 三、数据格式转换说明

### 3.1 日期格式

| API | 格式 | 示例 |
|---|---|---|
| 本公司API | YYYY-MM-DD 或 YYYY-MM-DD HH:mm:ss | 2025-12-29 或 2025-12-29 16:59:45 |
| 长软API | YYYYMMDD | 20251229 |

**转换规则**：
- 本公司 → 长软：移除日期分隔符，截取前8位
- 长软 → 本公司：插入"-"分隔符

### 3.2 数值类型

| 数据项 | 本公司API | 长软API | 转换说明 |
|---|---|---|---|
| 金额、税额 | number (18,2) | VARCHAR2(32) | 长软使用字符串，需要类型转换 |
| 价税合计 | number (18,2) | VARCHAR2(32) | 长软使用字符串，需要类型转换 |
| 税率 | number (8,5) | NUMBER(8,5) | 类型一致 |

### 3.3 XML与JSON结构差异

**长软API (XML结构)**:
```xml
<MSG>
  <HEAD>
    <FPLX>{发票代码}</FPLX>
    <FPDM>{发票代码}</FPDM>
    <FPHM>{发票号码}</FPHM>
    <CYJGDM>001</CYJGDM>
  </HEAD>
  <BODY>
    <!-- 根据实际发票类型的XML样例填写 -->
  </BODY>
</MSG>
```

**本公司API (JSON结构)**:
```json
{
  "invoice_type": "{发票代码}",
  "invoice_code": "{发票代码}",
  "invoice_number": "{发票号码}",
  "result_code": "00"
  // 根据实际发票类型的JSON结构填写
}
```

---

## 四、特殊字段说明（枚举映射）

> **本章节内容为通用枚举映射，适用于所有发票类型。**
>
> 详见独立文档：**[00_通用说明_枚举映射.md](./00_通用说明_枚举映射.md)**

本章节包含以下通用映射规则：
- **4.1 查验结果代码映射** (CYJGDM → result_code / error)
- **4.2 发票状态/作废标志映射** (ZFBZ → invoice_status)
- **4.3 特殊票种标志映射** (TSPZBZ → special_invoice_type)
- **4.4 枚举映射示例**

### 快速参考

#### 查验结果代码（CYJGDM）

| 长软代码 | 含义 | 映射到本公司API |
|---|---|---|
| 001 | 查验成功发票一致 | `result_code: "00"` (HTTP 200) |
| 006 | 查验成功发票不一致 | `result_code: "03"` (HTTP 200) |
| 009 | 所查发票不存在 | `result_code: "02"` (HTTP 200) |
| 002-109 | 技术错误/业务阻止 | `error.code` (HTTP 4xx/5xx) |

#### 发票状态（ZFBZ）

| 长软 | 本公司 | 说明 |
|---|---|---|
| 0, 1, N | 0 或 1 | 正常 |
| 2, Y | 2 | 作废 |
| 3 | 3 | 红冲 |
| 7, 8 | 7, 8 | 部分/全额红冲 |

**完整映射规则请查看**: [00_通用说明_枚举映射.md](./00_通用说明_枚举映射.md)

---

## 五、集成注意事项

### 5.1 必填字段对比

**长软API必填 (但本公司API可选)**:
- {根据PDF文档第3.2.3.X节的required字段填写}

**本公司API必填 (但长软API可选)**:
- {根据Apifox JSON中的required字段填写}

### 5.2 字段长度差异

| 字段 | 本公司API | 长软API | 风险评估 |
|---|---|---|---|
| {字段名} | {长度} | {长度} | ⚠️ {评估说明} |

### 5.3 数据完整性

1. **长软独有字段**（本公司API需考虑是否补充）:
   - `{字段}` ({说明})
   - ...

2. **本公司独有字段**（可能需要从其他数据源获取）:
   - `{字段}` ({说明})
   - ...

### 5.4 {发票类型}特殊说明

> ⚠️ 根据该发票类型的特殊性补充说明
>
> 例如：
> - 03机动车：购方可能是个人，使用身份证号而非税号
> - 15二手车：涉及买卖双方、经营单位、二手车市场等多方信息
> - 11卷式发票：无货物明细，只有项目级信息

---

## 六、映射示例

### 示例1：基本发票信息

**长软API返回**:
```xml
<BODY>
  <FPDM>{发票代码}</FPDM>
  <FPHM>{发票号码}</FPHM>
  <KPRQ>{开票日期YYYYMMDD}</KPRQ>
  <!-- 根据实际XML样例填写 -->
</BODY>
```

**映射到本公司API**:
```json
{
  "invoice_code": "{发票代码}",
  "invoice_number": "{发票号码}",
  "issue_date": "{YYYY-MM-DD}"
  // 根据实际JSON结构填写
}
```

### 示例2：{明细/特殊结构}映射

**长软API返回**:
```xml
<!-- 根据实际XML样例填写 -->
```

**映射到本公司API**:
```json
{
  // 根据实际JSON结构填写
}
```

---

## 七、版本历史

| 版本 | 日期 | 修订内容 | 作者 |
|---|---|---|---|
| v1.0 | {YYYY-MM-DD} | 初始版本，创建{发票代码}{发票名称}字段映射表 | {作者} |

---

## 八、参考文档

1. 本公司API定义: `invoice_verification.apifox.json`
2. 长软API文档: `【长软】发票查验服务调用说明V4.0.16.pdf` - 第3.2.3.X节
3. 通用枚举映射: `00_通用说明_枚举映射.md`
4. 国家税务总局发票查验平台: https://inv-veri.chinatax.gov.cn/

---

**文档结束**
