# Prompt: 快速生成新发票类型字段映射表

**文档版本**: v1.0
**创建日期**: 2025-12-29
**适用场景**: 为新的发票类型（03、04、10、11、14、15等）快速生成字段映射文档

---

## 使用方法

### 第一步：准备工作

在开始生成新发票映射表之前，请确保已准备好以下文件：

1. **本公司API规范**: `invoice_verification.apifox.json`
2. **长软API文档**: `docs/【长软】发票查验服务调用说明V4.0.16.pdf`
3. **文档模板**: `docs/mappings/TEMPLATE_发票映射表模板.md`
4. **通用枚举映射**: `docs/mappings/00_通用说明_枚举映射.md`（已创建，无需修改）

---

## 第二步：AI Prompt模板

将以下prompt复制后，替换 `{发票类型代码}` 和 `{发票类型名称}`，然后提交给AI助手：

```
请为发票类型 "{发票类型代码}: {发票类型名称}" 创建字段映射表。

## 任务要求：

1. **基于模板**: 使用 @docs/mappings/TEMPLATE_发票映射表模板.md 作为基础模板
2. **数据来源**:
   - 本公司API定义: @invoice_verification.apifox.json（搜索发票类型代码: {发票类型代码}）
   - 长软API定义: @docs/【长软】发票查验服务调用说明V4.0.16.pdf（第3.2.3.X节，X为发票类型序号）
3. **引用通用文档**: 第四章必须引用 @docs/mappings/00_通用说明_枚举映射.md，不要重复定义枚举映射

## 具体步骤：

### 步骤1：读取源文档
- 从 invoice_verification.apifox.json 中找到该发票类型的响应schema（使用grep搜索 "invoice_type.*{发票类型代码}"）
- 从长软PDF文档中找到对应章节（通常在第3.2.3.X节）

### 步骤2：填充字段映射表

#### 第一章：发票主信息字段映射
- 列出该发票类型在 `BODY` 下的所有主信息字段
- 对比本公司API与长软API的字段名、中文名、数据类型
- 填写映射说明（直接映射/格式转换/类型转换/长软独有/本公司独有）
- **注意标注**:
  - ⚠️ 长软独有字段（如 `CYCS` 查验次数）
  - 🔄 需要格式转换的字段（如日期 `KPRQ`）
  - 📝 类型转换字段（如字符串金额 → number）

#### 第二章：明细结构字段映射
- **判断该发票类型是否有明细结构**:
  - ✅ 有货物明细：01增值税专用发票、04增值税普通发票、10电子发票等
    - 本公司API路径: `items[]`
    - 长软API路径: `BODY/CHILDLIST/CHILD[]`
  - ✅ 有特殊结构：03机动车（车辆信息）、15二手车（买卖双方信息）
    - 根据实际结构调整章节标题和路径
  - ❌ 无明细：11卷式发票等
    - 删除本章节或标注"本发票类型无明细结构"

- 列出明细字段映射表

#### 第三章：数据格式转换说明
- **保持通用部分不变**（日期格式、数值类型、XML与JSON结构差异）
- **补充该发票类型特有的转换规则**（如有）

#### 第四章：特殊字段说明（枚举映射）
- **直接引用通用文档**，无需修改
- **仅保留快速参考表**

#### 第五章：集成注意事项
- **5.1 必填字段对比**:
  - 从长软PDF文档中识别required字段
  - 从Apifox JSON中识别required字段
  - 对比差异并列出

- **5.2 字段长度差异**:
  - 对比字段长度限制（如 `发票代码` 本公司12位 vs 长软20位）
  - 评估风险（超长截断、长度不足等）

- **5.3 数据完整性**:
  - 列出长软独有字段（本公司API可能需要补充）
  - 列出本公司独有字段（可能需要从其他数据源获取）

- **5.4 {发票类型}特殊说明**:
  - ⚠️ **这是最重要的部分，必须根据该发票类型的业务特性补充**
  - 参考示例：
    - 03机动车：购方可能是个人，使用身份证号而非税号；含车辆识别代号、合格证号等特殊字段
    - 15二手车：涉及买卖双方、经营单位、二手车市场等多方信息
    - 11卷式发票：无货物明细，只有项目级信息；金额可能为定额
    - 14通行费：含车牌号、入出口信息等特殊字段
    - 10电子发票：可能包含二维码、电子签章等数字化字段

#### 第六章：映射示例
- **提供2-3个实际XML到JSON的映射示例**:
  - 示例1：基本发票信息（主信息字段映射）
  - 示例2：明细/特殊结构映射（如有）
  - 示例3：特殊场景（如作废发票、红冲发票等）

- **使用真实或接近真实的数据**（可参考长软PDF中的XML样例）

#### 第七章：版本历史
- 初始版本标记为 v1.0
- 创建日期填写今天的日期
- 作者填写 "{你的名字}"

#### 第八章：参考文档
- 保持不变，引用正确的源文档路径

### 步骤3：质量检查

完成映射表后，请检查：
- [ ] 所有 `{占位符}` 已被替换为实际内容
- [ ] 第一章包含该发票类型的所有主信息字段（对比长软PDF的BODY节点）
- [ ] 第二章根据是否有明细结构正确调整（有明细则填写，无明细则删除或标注）
- [ ] 第四章正确引用 `00_通用说明_枚举映射.md`，没有重复定义枚举
- [ ] 第五章5.4节补充了该发票类型的特殊说明
- [ ] 第六章提供了至少2个实际的映射示例
- [ ] 所有表格格式正确，列对齐
- [ ] 所有代码块使用正确的语言标记（xml/json）

### 步骤4：输出文档

将生成的文档保存为: `docs/mappings/{发票类型代码}_{发票类型名称}_字段映射表.md`

例如: `docs/mappings/03_机动车销售统一发票_字段映射表.md`
```

---

## 第三步：常见发票类型清单

以下是可以使用此prompt生成映射表的发票类型：

| 发票类型代码 | 发票类型名称 | 长软PDF章节 | 是否有明细 | 特殊说明 |
|---|---|---|---|---|
| 03 | 机动车销售统一发票 | 3.2.3.2 | ❌ 无（车辆信息） | 购方可能是个人；含车辆识别代号 |
| 04 | 增值税普通发票 | 3.2.3.3 | ✅ 有 | 类似01，但无抵扣联 |
| 10 | 电子发票（增值税专用发票） | 3.2.3.4 | ✅ 有 | 电子化字段（二维码、电子签章） |
| 11 | 卷式发票 | 3.2.3.5 | ❌ 无 | 无明细；可能为定额发票 |
| 14 | 通行费发票 | 3.2.3.6 | ❌ 无 | 含车牌号、入出口信息 |
| 15 | 二手车销售统一发票 | 3.2.3.7 | ❌ 无 | 买卖双方、经营单位、市场信息 |

**提示**: 优先处理业务中常用的发票类型（如04、10）。

---

## 第四步：批量生成建议

如需一次性生成多个发票类型的映射表，可以：

1. **方案A：逐个生成**（推荐）
   - 对每个发票类型单独使用上述prompt
   - 优点：每个文档都经过仔细检查，质量更高
   - 缺点：耗时较长

2. **方案B：批量生成**（适合熟悉业务后）
   - 在一个prompt中列出多个发票类型
   - AI助手可并行处理
   - 优点：速度快
   - 缺点：需要人工逐个检查质量

---

## 第五步：维护更新

当源文档更新时（如长软API升级到V5.0、本公司API增加字段），请：

1. **更新通用枚举文档**（如有新增枚举值）:
   - 修改 `00_通用说明_枚举映射.md`
   - 所有引用该文档的映射表自动受益

2. **更新各发票类型映射表**:
   - 在"版本历史"章节记录变更
   - 更新受影响的字段映射
   - 增加版本号（如 v1.0 → v1.1）

---

## 附录：实际使用示例

### 示例：为"03机动车销售统一发票"生成映射表

**完整prompt**:

```
请为发票类型 "03: 机动车销售统一发票" 创建字段映射表。

## 任务要求：

1. **基于模板**: 使用 @docs/mappings/TEMPLATE_发票映射表模板.md 作为基础模板
2. **数据来源**:
   - 本公司API定义: @invoice_verification.apifox.json（搜索发票类型代码: 03）
   - 长软API定义: @docs/【长软】发票查验服务调用说明V4.0.16.pdf（第3.2.3.2节）
3. **引用通用文档**: 第四章必须引用 @docs/mappings/00_通用说明_枚举映射.md，不要重复定义枚举映射

## 具体步骤：

[... 使用上面"第二步"中的完整步骤 ...]

### 步骤3：质量检查

完成映射表后，请检查：
- [ ] 所有 `{占位符}` 已被替换为实际内容
- [ ] 第一章包含机动车发票的所有主信息字段（如车辆识别代号、合格证号等）
- [ ] 第二章已调整为"车辆信息字段映射"或删除
- [ ] 第四章正确引用 `00_通用说明_枚举映射.md`
- [ ] 第五章5.4节补充了机动车发票的特殊说明（如购方可能是个人）
- [ ] 第六章提供了实际的XML到JSON映射示例

### 步骤4：输出文档

将生成的文档保存为: `docs/mappings/03_机动车销售统一发票_字段映射表.md`
```

---

## 注意事项

1. **不要修改通用枚举文档** (`00_通用说明_枚举映射.md`)，除非长软API或本公司API的枚举定义发生变化

2. **第四章只引用，不重复定义**，保持各发票类型映射表的简洁性

3. **第五章5.4节是关键**，必须根据该发票类型的业务特性补充说明，不能留空或使用模板占位符

4. **映射示例要真实**，最好从长软PDF中复制XML样例，然后手动转换为JSON格式

5. **字段完整性检查**：
   - 长软PDF的BODY节点下的所有字段都应该在第一章中有映射
   - 长软PDF的CHILDLIST节点下的所有字段都应该在第二章中有映射（如有明细）

---

## 文档结束

**维护者**: 请在每次使用此prompt生成新映射表后，在下方记录：

| 日期 | 生成的发票类型 | 生成者 | 备注 |
|---|---|---|---|
| 2025-12-29 | 01 增值税专用发票 | Claude | 初始版本（手动创建） |
| | | | |
