# å‘ç¥¨æŸ¥éªŒAPI - é€šç”¨è¯·æ±‚å‚æ•°æ˜ å°„è¯´æ˜

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**åˆ›å»ºæ—¥æœŸ**: 2025-12-30
**é€‚ç”¨èŒƒå›´**: æ‰€æœ‰å‘ç¥¨ç±»å‹

---

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£å®šä¹‰äº†æœ¬å…¬å¸å‘ç¥¨æŸ¥éªŒAPIä¸é•¿è½¯å‘ç¥¨æŸ¥éªŒæœåŠ¡ä¹‹é—´çš„**é€šç”¨è¯·æ±‚å‚æ•°æ˜ å°„å…³ç³»**ã€‚

è¿™äº›å‚æ•°æ˜ å°„é€‚ç”¨äºæ‰€æœ‰å‘ç¥¨ç±»å‹ï¼ˆ01ã€03ã€04ã€08ã€10ã€11ã€14ã€15ã€81-88ã€51ã€61ç­‰ï¼‰ï¼Œå„å‘ç¥¨ç±»å‹çš„æ˜ å°„è¡¨æ–‡æ¡£åº”å¼•ç”¨æœ¬æ–‡æ¡£ï¼Œæ— éœ€é‡å¤å®šä¹‰ã€‚

- **æœ¬å…¬å¸API**: [`/partners/invoice-verifications`](https://s.apifox.cn/2795ad32-31e7-4363-8294-578e8dc6202c/395314528e0) (RESTful JSONæ ¼å¼)
- **é•¿è½¯API**: ã€é•¿è½¯ã€‘å‘ç¥¨æŸ¥éªŒæœåŠ¡è°ƒç”¨è¯´æ˜V4.0.16.pdf (XMLæ ¼å¼)

---

## ä¸€ã€æ¥å£åŸºæœ¬ä¿¡æ¯å¯¹æ¯”

### 1.1 æœ¬å…¬å¸API

| é¡¹ç›® | å€¼ |
|------|-----|
| **æ¥å£è·¯å¾„** | `/partners/invoice-verifications` |
| **HTTPæ–¹æ³•** | `POST` |
| **åè®®** | HTTPS RESTful |
| **æ•°æ®æ ¼å¼** | JSON |
| **å­—ç¬¦ç¼–ç ** | UTF-8 |
| **è®¤è¯æ–¹å¼** | Bearer Token (Authorization Header) |

### 1.2 é•¿è½¯API

| é¡¹ç›® | å€¼ |
|------|-----|
| **æ¥å£åœ°å€** | `https://xxx.xxx.xxx.xxx:443/fpcyService/fpcyService.do` |
| **HTTPæ–¹æ³•** | `POST` |
| **åè®®** | HTTP POST |
| **æ•°æ®æ ¼å¼** | XML |
| **å­—ç¬¦ç¼–ç ** | UTF-8 |
| **è®¤è¯æ–¹å¼** | ç”¨æˆ·å+ç­¾åï¼ˆMD5ï¼‰ |

---

## äºŒã€HTTPè¯·æ±‚å¤´å‚æ•°æ˜ å°„

### 2.1 æœ¬å…¬å¸APIè¯·æ±‚å¤´

æœ¬å…¬å¸APIä½¿ç”¨æ ‡å‡†çš„HTTPè¯·æ±‚å¤´è¿›è¡Œè®¤è¯å’Œé“¾è·¯è¿½è¸ªï¼š

| è¯·æ±‚å¤´åç§° | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|-----------|------|------|------|--------|
| **Authorization** | string | âœ… æ˜¯ | Bearer tokenï¼Œç”¨äºAPIèº«ä»½éªŒè¯ | `Bearer eyJhbGciOiJIUzI1Ni...` |
| **X-Request-Id** | string | âœ… æ˜¯ | å…¨å±€å”¯ä¸€è¯·æ±‚IDï¼Œç”¨äºé“¾è·¯è¿½è¸ªä¸æ—¥å¿—å…³è” | `req_1735548170_48210952` |
| **X-Customer-Id** | string | âœ… æ˜¯ | å®¢æˆ·ç¼–å·ï¼Œ10ä½æ•°å­— | `1234567890` |
| **Accept-Language** | string | âŒ å¦ | å“åº”è¯­è¨€ï¼ŒIETF BCP 47æ ¼å¼ | `zh-CN` æˆ– `en-US` |

### 2.2 é•¿è½¯APIè®¤è¯å‚æ•°

é•¿è½¯APIä¸ä½¿ç”¨HTTPè¯·æ±‚å¤´è¿›è¡Œè®¤è¯ï¼Œè®¤è¯ä¿¡æ¯åŒ…å«åœ¨XMLæŠ¥æ–‡ä¸­ï¼š

| XMLå­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|---------|------|------|------|
| **USERNAME** | VARCHAR(10) | âœ… æ˜¯ | å‘ç¥¨æŸ¥éªŒæœåŠ¡å¹³å°åˆ†é…çš„ç”¨æˆ·å |
| **SENDTIME** | VARCHAR(14) | âœ… æ˜¯ | æ•°æ®å‘é€æ—¶é—´ï¼Œæ ¼å¼YYYYMMDDHHMMSS |
| **SIGN** | VARCHAR(400) | âœ… æ˜¯ | ç­¾åï¼Œå¯¹ `USERNAME+FPDM+FPHM+SENDTIME+PASSWORD` è¿›è¡ŒMD5åŠ å¯† |

### 2.3 è®¤è¯å‚æ•°æ˜ å°„é€»è¾‘

```
æœ¬å…¬å¸APIè®¤è¯æµç¨‹:
1. å®¢æˆ·ç«¯åœ¨ Authorization è¯·æ±‚å¤´ä¸­æä¾› Bearer Token
2. æœåŠ¡ç«¯éªŒè¯Tokenæœ‰æ•ˆæ€§
3. ä»Tokenä¸­æå–å®¢æˆ·ä¿¡æ¯ï¼ˆå®¢æˆ·IDã€æƒé™ç­‰ï¼‰
4. ä½¿ç”¨æå–çš„å®¢æˆ·ä¿¡æ¯è°ƒç”¨é•¿è½¯API

æ˜ å°„åˆ°é•¿è½¯API:
1. æ ¹æ®å®¢æˆ·IDæŸ¥è¯¢å¯¹åº”çš„é•¿è½¯è´¦æˆ·é…ç½®ï¼ˆUSERNAMEã€PASSWORDï¼‰
2. ç”ŸæˆSENDTIMEï¼ˆå½“å‰æ—¶é—´ï¼Œæ ¼å¼YYYYMMDDHHMMSSï¼‰
3. è®¡ç®—SIGN = MD5(USERNAME + FPDM + FPHM + SENDTIME + PASSWORD)
4. å°†USERNAMEã€SENDTIMEã€SIGNå†™å…¥XMLæŠ¥æ–‡
```

âš ï¸ **é‡è¦æç¤º**ï¼š
- é•¿è½¯è´¦æˆ·å‡­è¯ï¼ˆUSERNAMEã€PASSWORDï¼‰ç”±ç³»ç»Ÿç®¡ç†å‘˜é…ç½®ï¼Œå­˜å‚¨åœ¨åç«¯æ•°æ®åº“æˆ–é…ç½®ä¸­å¿ƒ
- **ç¦æ­¢**å°†é•¿è½¯PASSWORDæš´éœ²åˆ°APIå“åº”æˆ–æ—¥å¿—ä¸­
- æ¯ä¸ªå®¢æˆ·å¯èƒ½å¯¹åº”ä¸åŒçš„é•¿è½¯è´¦æˆ·ï¼Œéœ€å»ºç«‹å®¢æˆ·IDä¸é•¿è½¯è´¦æˆ·çš„æ˜ å°„å…³ç³»

---

## ä¸‰ã€è¯·æ±‚ä½“å‚æ•°æ˜ å°„

### 3.1 é€šç”¨å‚æ•°å¯¹ç…§è¡¨

| æœ¬å…¬å¸APIå­—æ®µ | æœ¬å…¬å¸ç±»å‹ | æœ¬å…¬å¸å¿…å¡« | é•¿è½¯APIå­—æ®µ | é•¿è½¯ç±»å‹ | é•¿è½¯å¿…å¡« | æ˜ å°„è¯´æ˜ |
|--------------|-----------|-----------|------------|---------|---------|----------|
| `invoice_type` | string(2) | âœ… æ˜¯* | `FPLX` | VARCHAR(2) | âŒ å¦ | ç›´æ¥æ˜ å°„ï¼Œè§å‘ç¥¨ç±»å‹æšä¸¾æ˜ å°„ |
| `invoice_code` | string(12) | âš ï¸ æ¡ä»¶ | `FPDM` | VARCHAR(12) | âŒ å¦ | ç›´æ¥æ˜ å°„ï¼Œ10ä½æˆ–12ä½å‘ç¥¨ä»£ç  |
| `invoice_number` | string(20) | âœ… æ˜¯ | `FPHM` | VARCHAR(8) | âœ… æ˜¯ | ç›´æ¥æ˜ å°„ï¼Œ8ä½æˆ–20ä½æ•°å­—ï¼ˆæ•°ç”µå‘ç¥¨20ä½ï¼‰ |
| `issue_date` | string | âœ… æ˜¯ | `KPRQ` | VARCHAR(8) | âœ… æ˜¯ | **æ ¼å¼è½¬æ¢**ï¼š`YYYY-MM-DD` â†’ `YYYYMMDD` |
| `verification_code` | string(32) | âš ï¸ æ¡ä»¶ | `JYM` | VARCHAR(6) | âŒ å¦ | **æˆªå–å6ä½**ï¼š`verification_code.substring(verification_code.length - 6)` |
| `invoice_amount` | number(18,2) | âš ï¸ æ¡ä»¶ | `FPJE` | VARCHAR(20) | âŒ å¦ | **ç±»å‹è½¬æ¢**ï¼š`number.toString()` |
| `company_tax_no` | string(20) | âš ï¸ æ¡ä»¶ | - | - | - | **æœ¬å…¬å¸ç‹¬æœ‰**ï¼Œç”¨äºä¹ä¼é€šé“æŸ¥éªŒ |
| - | - | - | `VERSION` | VARCHAR(10) | âœ… æ˜¯ | **é•¿è½¯ç‹¬æœ‰**ï¼Œå›ºå®šå€¼ `4.0.12` æˆ–æ›´é«˜ç‰ˆæœ¬ |

**æ ‡æ³¨è¯´æ˜**ï¼š
- âœ… **æ˜¯**ï¼šæ‰€æœ‰åœºæ™¯éƒ½å¿…å¡«
- âŒ **å¦**ï¼šæ‰€æœ‰åœºæ™¯éƒ½å¯é€‰
- âš ï¸ **æ¡ä»¶**ï¼šæ ¹æ®å‘ç¥¨ç±»å‹æˆ–æŸ¥éªŒå¹³å°æœ‰ä¸åŒçš„å¿…å¡«è¦æ±‚

### 3.2 å‘ç¥¨ç±»å‹æšä¸¾æ˜ å°„ (invoice_type â†” FPLX)

| æœ¬å…¬å¸API (invoice_type) | é•¿è½¯API (FPLX) | å‘ç¥¨ç±»å‹åç§° | ç‰¹æ®Šè¯´æ˜ |
|------------------------|---------------|------------|----------|
| **01** | **01** | å¢å€¼ç¨ä¸“ç”¨å‘ç¥¨ | |
| **02** | **01** | è´§ç‰©è¿è¾“ä¸šå¢å€¼ç¨ä¸“ç”¨å‘ç¥¨ | æœ¬å…¬å¸02æ˜ å°„åˆ°é•¿è½¯01 |
| **03** | **03** | æœºåŠ¨è½¦é”€å”®ç»Ÿä¸€å‘ç¥¨ | |
| **04** | **04** | å¢å€¼ç¨æ™®é€šå‘ç¥¨ | |
| **08** | **20** | å¢å€¼ç¨ç”µå­ä¸“ç”¨å‘ç¥¨ | |
| **10** | **10** | å¢å€¼ç¨ç”µå­æ™®é€šå‘ç¥¨ | |
| **11** | **11** | å¢å€¼ç¨æ™®é€šå‘ç¥¨ï¼ˆå·å¼ï¼‰ | |
| **14** | **14** | å¢å€¼ç¨æ™®é€šå‘ç¥¨ï¼ˆé€šè¡Œè´¹ï¼‰ | |
| **15** | **15** | äºŒæ‰‹è½¦é”€å”®ç»Ÿä¸€å‘ç¥¨ | |
| **51** | **83** | ç”µå­å‘ç¥¨ï¼ˆé“è·¯ç”µå­å®¢ç¥¨ï¼‰ | |
| **61** | **61** | ç”µå­å‘ç¥¨ï¼ˆèˆªç©ºè¿è¾“å®¢ç¥¨ç”µå­è¡Œç¨‹å•ï¼‰ | |
| **81** | **09** | ç”µå­å‘ç¥¨ï¼ˆæ•°ç”µå‘ç¥¨-å¢å€¼ç¨ä¸“ç”¨å‘ç¥¨ï¼‰ | éœ€åœ¨HEADä¸­è®¾ç½®QDLX=20 |
| **82** | **09** | ç”µå­å‘ç¥¨ï¼ˆæ•°ç”µå‘ç¥¨-æ™®é€šå‘ç¥¨ï¼‰ | éœ€åœ¨HEADä¸­è®¾ç½®QDLX=10 |
| **83** | **09** | ç”µå­å‘ç¥¨ï¼ˆæ•°ç”µå‘ç¥¨-æœºåŠ¨è½¦ï¼‰ | éœ€åœ¨HEADä¸­è®¾ç½®QDLX=03 |
| **84** | **09** | ç”µå­å‘ç¥¨ï¼ˆæ•°ç”µå‘ç¥¨-äºŒæ‰‹è½¦ï¼‰ | éœ€åœ¨HEADä¸­è®¾ç½®QDLX=15 |
| **85** | **09** | çº¸è´¨å‘ç¥¨ï¼ˆæ•°ç”µçº¸è´¨å‘ç¥¨-å¢å€¼ç¨ä¸“ç”¨å‘ç¥¨ï¼‰ | éœ€åœ¨HEADä¸­è®¾ç½®QDLX=01 |
| **86** | **09** | çº¸è´¨å‘ç¥¨ï¼ˆæ•°ç”µçº¸è´¨å‘ç¥¨-æ™®é€šå‘ç¥¨ï¼‰ | éœ€åœ¨HEADä¸­è®¾ç½®QDLX=04 |
| **87** | **09** | çº¸è´¨å‘ç¥¨ï¼ˆæ•°ç”µçº¸è´¨å‘ç¥¨-æœºåŠ¨è½¦ï¼‰ | éœ€åœ¨HEADä¸­è®¾ç½®QDLX=03 |
| **88** | **09** | çº¸è´¨å‘ç¥¨ï¼ˆæ•°ç”µçº¸è´¨å‘ç¥¨-äºŒæ‰‹è½¦ï¼‰ | éœ€åœ¨HEADä¸­è®¾ç½®QDLX=15 |
| **F1** | - | è´¢æ”¿ç¥¨æ®ï¼ˆè´¢æ”¿ç”µå­ç¥¨æ®ï¼‰ | **ä¸é€šè¿‡é•¿è½¯æŸ¥éªŒï¼Œèµ°è´¢æ”¿éƒ¨å¹³å°** |

âš ï¸ **æ•°ç”µå‘ç¥¨ç‰¹æ®Šå¤„ç†**ï¼š
- é•¿è½¯APIå¯¹æ•°ç”µå‘ç¥¨ç»Ÿä¸€ä½¿ç”¨ `FPLX=09`
- éœ€è¦åœ¨XMLå“åº”çš„ `HEAD/QDLX` å­—æ®µä¸­åŒºåˆ†å­ç±»å‹ï¼ˆ10/20/01/04/03/15ï¼‰
- æœ¬å…¬å¸APIåœ¨è¯·æ±‚æ—¶éœ€è¦ç²¾ç¡®æŒ‡å®šç±»å‹ï¼ˆ81-88ï¼‰ï¼Œåœ¨å“åº”æ—¶åŒæ ·è¿”å›ç²¾ç¡®ç±»å‹

---

## å››ã€å‚æ•°æ ¼å¼è½¬æ¢è§„åˆ™

### 4.1 æ—¥æœŸæ ¼å¼è½¬æ¢

| API | æ ¼å¼ | ç¤ºä¾‹ | æ­£åˆ™è¡¨è¾¾å¼ |
|-----|------|------|-----------|
| æœ¬å…¬å¸API | `YYYY-MM-DD` | `2025-12-30` | `^\d{4}-\d{2}-\d{2}$` |
| é•¿è½¯API | `YYYYMMDD` | `20251230` | `^\d{8}$` |

**è½¬æ¢é€»è¾‘**ï¼š

```javascript
// æœ¬å…¬å¸ â†’ é•¿è½¯
function toChangruanDateFormat(issueDate) {
  // è¾“å…¥: "2025-12-30"
  // è¾“å‡º: "20251230"
  return issueDate.replace(/-/g, '');
}

// é•¿è½¯ â†’ æœ¬å…¬å¸
function fromChangruanDateFormat(kprq) {
  // è¾“å…¥: "20251230"
  // è¾“å‡º: "2025-12-30"
  return `${kprq.substring(0, 4)}-${kprq.substring(4, 6)}-${kprq.substring(6, 8)}`;
}
```

### 4.2 é‡‘é¢æ ¼å¼è½¬æ¢

| API | ç±»å‹ | ç²¾åº¦ | ç¤ºä¾‹ |
|-----|------|------|------|
| æœ¬å…¬å¸API | `number` | (18,2) | `10000.00` |
| é•¿è½¯API | `VARCHAR` | å­—ç¬¦ä¸² | `"10000.00"` |

**è½¬æ¢é€»è¾‘**ï¼š

```javascript
// æœ¬å…¬å¸ â†’ é•¿è½¯
function toChangruanAmountFormat(amount) {
  // è¾“å…¥: 10000.00 (number)
  // è¾“å‡º: "10000.00" (string)
  return amount.toFixed(2);
}

// é•¿è½¯ â†’ æœ¬å…¬å¸
function fromChangruanAmountFormat(fpje) {
  // è¾“å…¥: "10000.00" (string)
  // è¾“å‡º: 10000.00 (number)
  return parseFloat(fpje);
}
```

### 4.3 æ ¡éªŒç æ ¼å¼è½¬æ¢

| åœºæ™¯ | æœ¬å…¬å¸API | é•¿è½¯API | è½¬æ¢è¯´æ˜ |
|------|-----------|---------|----------|
| å®Œæ•´æ ¡éªŒç  | `"12345678901234567890"` (32ä½) | `"567890"` (å6ä½) | **æˆªå–å6ä½** |
| æ•°ç”µçº¸è´¨æ™®ç¥¨ | `"20ä½æ•°ç”µå‘ç¥¨å·ç "` | `"å·ç å6ä½"` | **ç‰¹æ®Šå¤„ç†** |

**è½¬æ¢é€»è¾‘**ï¼š

```javascript
// æœ¬å…¬å¸ â†’ é•¿è½¯
function toChangruanVerificationCode(verificationCode, invoiceType) {
  if (!verificationCode) return '';

  // æ•°ç”µçº¸è´¨æ™®ç¥¨(86)ï¼šä½¿ç”¨æ•°ç”µå‘ç¥¨å·ç å6ä½
  if (invoiceType === '86') {
    // ä»invoice_numberå­—æ®µè·å–20ä½æ•°ç”µå·ç 
    return invoice_number.substring(invoice_number.length - 6);
  }

  // å…¶ä»–ç±»å‹ï¼šä½¿ç”¨æ ¡éªŒç å6ä½
  return verificationCode.substring(verificationCode.length - 6);
}
```

---

## äº”ã€ä¸åŒå‘ç¥¨ç±»å‹çš„å¿…å¡«å‚æ•°å·®å¼‚

### 5.1 ç¨åŠ¡æ€»å±€æŸ¥éªŒå¹³å°ï¼ˆé•¿è½¯é€šé“ï¼‰

#### 5.1.1 ä¼ ç»Ÿå‘ç¥¨ç±»å‹

| å‘ç¥¨ç±»å‹ | invoice_type | å¿…å¡«å­—æ®µ | é‡‘é¢å­—æ®µå«ä¹‰ |
|---------|-------------|---------|------------|
| å¢å€¼ç¨ä¸“ç”¨å‘ç¥¨ | 01 | invoice_code, invoice_number, issue_date, invoice_amount | **ä¸å«ç¨é‡‘é¢** |
| è´§è¿ä¸“ç¥¨ | 02 | invoice_code, invoice_number, issue_date, invoice_amount | **ä¸å«ç¨é‡‘é¢** |
| æœºåŠ¨è½¦å‘ç¥¨ | 03 | invoice_code, invoice_number, issue_date, invoice_amount | **ä¸å«ç¨é‡‘é¢** |
| å¢å€¼ç¨æ™®é€šå‘ç¥¨ | 04 | invoice_code, invoice_number, issue_date, verification_code | æ ¡éªŒç å6ä½ |
| ç”µå­ä¸“ç¥¨ | 08 | invoice_code, invoice_number, issue_date, invoice_amount | **ä¸å«ç¨é‡‘é¢** |
| ç”µå­æ™®ç¥¨ | 10 | invoice_code, invoice_number, issue_date, verification_code | æ ¡éªŒç å6ä½ |
| å·å¼å‘ç¥¨ | 11 | invoice_code, invoice_number, issue_date, verification_code | æ ¡éªŒç å6ä½ |
| é€šè¡Œè´¹å‘ç¥¨ | 14 | invoice_code, invoice_number, issue_date, verification_code | æ ¡éªŒç å6ä½ |
| äºŒæ‰‹è½¦å‘ç¥¨ | 15 | invoice_code, invoice_number, issue_date, invoice_amount | **è½¦ä»·åˆè®¡** |

#### 5.1.2 æ•°ç”µå‘ç¥¨ç±»å‹

| å‘ç¥¨ç±»å‹ | invoice_type | å¿…å¡«å­—æ®µ | é‡‘é¢å­—æ®µå«ä¹‰ | ç‰¹æ®Šè¯´æ˜ |
|---------|-------------|---------|------------|----------|
| æ•°ç”µä¸“ç¥¨ | 81 | invoice_number(20ä½), issue_date, invoice_amount | **ä»·ç¨åˆè®¡** | æ— invoice_code |
| æ•°ç”µæ™®ç¥¨ | 82 | invoice_number(20ä½), issue_date, invoice_amount | **ä»·ç¨åˆè®¡** | æ— invoice_code |
| æ•°ç”µæœºåŠ¨è½¦ | 83 | invoice_number(20ä½), issue_date, invoice_amount | **ä»·ç¨åˆè®¡** | æ— invoice_code |
| æ•°ç”µäºŒæ‰‹è½¦ | 84 | invoice_number(20ä½), issue_date, invoice_amount | **ä»·ç¨åˆè®¡** | æ— invoice_code |
| æ•°ç”µé“è·¯å®¢ç¥¨ | 51 | invoice_number(20ä½), issue_date, invoice_amount | **ä»·ç¨åˆè®¡** | æ— invoice_code |
| æ•°ç”µèˆªç©ºå®¢ç¥¨ | 61 | invoice_number(20ä½), issue_date, invoice_amount | **ä»·ç¨åˆè®¡** | æ— invoice_code |

#### 5.1.3 æ•°ç”µçº¸è´¨å‘ç¥¨ç±»å‹ï¼ˆåŒé‡æŸ¥éªŒï¼‰

| å‘ç¥¨ç±»å‹ | invoice_type | æŸ¥éªŒæ–¹å¼ | å¿…å¡«å­—æ®µç»„åˆ |
|---------|-------------|---------|-------------|
| æ•°ç”µçº¸è´¨ä¸“ç¥¨ | 85 | **æ–¹å¼ä¸€** | invoice_code, invoice_number(8ä½), issue_date, invoice_amount(ä¸å«ç¨) |
| | | **æ–¹å¼äºŒ** | invoice_number(20ä½), issue_date, invoice_amount(ä»·ç¨åˆè®¡) |
| æ•°ç”µçº¸è´¨æ™®ç¥¨ | 86 | **æ–¹å¼ä¸€** | invoice_code, invoice_number(8ä½), issue_date, verification_code |
| | | **æ–¹å¼äºŒ** | invoice_number(20ä½), issue_date, invoice_amount(ä»·ç¨åˆè®¡) |
| æ•°ç”µçº¸è´¨æœºåŠ¨è½¦ | 87 | **ä»…ä¸€ç§** | invoice_code, invoice_number(8ä½), issue_date, invoice_amount(ä¸å«ç¨) |
| æ•°ç”µçº¸è´¨äºŒæ‰‹è½¦ | 88 | **ä»…ä¸€ç§** | invoice_code, invoice_number(8ä½), issue_date, invoice_amount(è½¦ä»·åˆè®¡) |

âš ï¸ **æ•°ç”µçº¸è´¨å‘ç¥¨ç‰¹æ®Šå¤„ç†**ï¼š
- æ•°ç”µçº¸è´¨å‘ç¥¨åŒæ—¶å°åˆ¶æœ‰**çº¸è´¨å‘ç¥¨å·ç **ï¼ˆ8ä½ï¼‰å’Œ**æ•°ç”µå‘ç¥¨å·ç **ï¼ˆ20ä½ï¼‰
- ç±»å‹85ã€86æ”¯æŒä¸¤ç§æŸ¥éªŒæ–¹å¼ï¼Œç³»ç»Ÿåº”ä¼˜å…ˆä½¿ç”¨æ–¹å¼ä¸€ï¼ˆçº¸è´¨å·ç ï¼‰
- ç±»å‹87ã€88ä»…æ”¯æŒçº¸è´¨å·ç æŸ¥éªŒ

### 5.2 ä¹ä¼æŸ¥éªŒæ¥å£

ä¹ä¼é€šé“çš„å¿…å¡«å­—æ®µä¸ç¨åŠ¡æ€»å±€åŸºæœ¬ä¸€è‡´ï¼Œä½†**é¢å¤–è¦æ±‚**ï¼š

| é¢å¤–å¿…å¡«å­—æ®µ | è¯´æ˜ |
|-------------|------|
| `company_tax_no` | æŸ¥éªŒä¼ä¸šçš„çº³ç¨äººè¯†åˆ«å·æˆ–ç»Ÿä¸€ç¤¾ä¼šä¿¡ç”¨ä»£ç  |

âš ï¸ **é‡è¦é™åˆ¶**ï¼š
- ä¹ä¼é€šé“**ä¸æ”¯æŒ**è´¢æ”¿ç¥¨æ®ï¼ˆF1ï¼‰æŸ¥éªŒ
- ä¹ä¼é€šé“æ‰€æœ‰å‘ç¥¨ç±»å‹éƒ½**å¿…é¡»æä¾›** `company_tax_no`

### 5.3 è´¢æ”¿éƒ¨æŸ¥éªŒå¹³å°

| å‘ç¥¨ç±»å‹ | invoice_type | å¿…å¡«å­—æ®µ |
|---------|-------------|---------|
| è´¢æ”¿ç”µå­ç¥¨æ® | F1 | invoice_code, invoice_number, issue_date, invoice_amount, verification_code |

âš ï¸ **æ³¨æ„**ï¼šè´¢æ”¿ç¥¨æ®**ä¸é€šè¿‡é•¿è½¯æŸ¥éªŒ**ï¼Œéœ€è¦å¯¹æ¥è´¢æ”¿éƒ¨æŸ¥éªŒå¹³å°ã€‚

---

## å…­ã€å¿…å¡«å‚æ•°éªŒè¯è§„åˆ™

### 6.1 å‘ç¥¨ä»£ç éªŒè¯

```javascript
// å‘ç¥¨ä»£ç éªŒè¯è§„åˆ™
function validateInvoiceCode(invoiceCode, invoiceType) {
  // æ•°ç”µå‘ç¥¨ï¼ˆ81ã€82ã€83ã€84ã€51ã€61ï¼‰æ— å‘ç¥¨ä»£ç 
  const digitalTypes = ['81', '82', '83', '84', '51', '61'];
  if (digitalTypes.includes(invoiceType)) {
    return invoiceCode === null || invoiceCode === '';
  }

  // å…¶ä»–ç±»å‹å¿…é¡»æ˜¯10ä½æˆ–12ä½æ•°å­—
  return /^\d{10}$|^\d{12}$/.test(invoiceCode);
}
```

### 6.2 å‘ç¥¨å·ç éªŒè¯

```javascript
// å‘ç¥¨å·ç éªŒè¯è§„åˆ™
function validateInvoiceNumber(invoiceNumber, invoiceType) {
  // æ•°ç”µå‘ç¥¨ï¼š20ä½æ•°å­—
  const digitalTypes = ['81', '82', '83', '84', '85', '86', '87', '88', '51', '61'];
  if (digitalTypes.includes(invoiceType)) {
    return /^\d{20}$/.test(invoiceNumber);
  }

  // ä¼ ç»Ÿå‘ç¥¨ï¼š8ä½æ•°å­—
  return /^\d{8}$/.test(invoiceNumber);
}
```

### 6.3 é‡‘é¢å­—æ®µéªŒè¯

```javascript
// é‡‘é¢å­—æ®µå¿…å¡«æ€§éªŒè¯
function validateInvoiceAmount(invoiceAmount, invoiceType) {
  const requireAmountTypes = [
    '01', '02', '03', '08', '15',  // ä¼ ç»Ÿä¸“ç¥¨ã€æœºåŠ¨è½¦ã€äºŒæ‰‹è½¦
    '20',                          // ç”µå­ä¸“ç¥¨ï¼ˆé•¿è½¯ç±»å‹ï¼‰
    '81', '82', '83', '84',       // æ•°ç”µå‘ç¥¨
    '85', '86', '87', '88',       // æ•°ç”µçº¸è´¨å‘ç¥¨
    '51', '61'                     // æ•°ç”µå®¢ç¥¨
  ];

  if (requireAmountTypes.includes(invoiceType)) {
    return invoiceAmount !== null && invoiceAmount > 0;
  }

  return true; // å…¶ä»–ç±»å‹é‡‘é¢å¯é€‰
}
```

### 6.4 æ ¡éªŒç éªŒè¯

```javascript
// æ ¡éªŒç å¿…å¡«æ€§éªŒè¯
function validateVerificationCode(verificationCode, invoiceType) {
  const requireCodeTypes = ['04', '10', '11', '14', 'F1'];

  if (requireCodeTypes.includes(invoiceType)) {
    return verificationCode !== null && verificationCode.length >= 6;
  }

  return true; // å…¶ä»–ç±»å‹æ ¡éªŒç å¯é€‰
}
```

---

## ä¸ƒã€è¯·æ±‚ç¤ºä¾‹

### 7.1 æœ¬å…¬å¸APIè¯·æ±‚ç¤ºä¾‹

#### ç¤ºä¾‹1ï¼šå¢å€¼ç¨ä¸“ç”¨å‘ç¥¨æŸ¥éªŒ

```http
POST /partners/invoice-verifications HTTP/1.1
Host: api.example.com
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
X-Request-Id: req_1735548170_12345678
X-Customer-Id: 1234567890
Content-Type: application/json
Accept-Language: zh-CN

{
  "invoice_type": "01",
  "invoice_code": "1100182130",
  "invoice_number": "63516373",
  "issue_date": "2025-12-30",
  "invoice_amount": 10000.00
}
```

#### ç¤ºä¾‹2ï¼šå¢å€¼ç¨ç”µå­æ™®é€šå‘ç¥¨æŸ¥éªŒ

```http
POST /partners/invoice-verifications HTTP/1.1
Host: api.example.com
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
X-Request-Id: req_1735548170_87654321
X-Customer-Id: 1234567890
Content-Type: application/json

{
  "invoice_type": "10",
  "invoice_code": "044001600111",
  "invoice_number": "20078888",
  "issue_date": "2025-12-30",
  "verification_code": "12345617888"
}
```

#### ç¤ºä¾‹3ï¼šæ•°ç”µå‘ç¥¨ï¼ˆä¸“ç¥¨ï¼‰æŸ¥éªŒ

```http
POST /partners/invoice-verifications HTTP/1.1
Host: api.example.com
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
X-Request-Id: req_1735548170_11111111
X-Customer-Id: 1234567890
Content-Type: application/json

{
  "invoice_type": "81",
  "invoice_number": "12345678901234567890",
  "issue_date": "2025-12-30",
  "invoice_amount": 11800.00
}
```

### 7.2 é•¿è½¯APIè¯·æ±‚ç¤ºä¾‹

#### ç¤ºä¾‹1ï¼šå¢å€¼ç¨ä¸“ç”¨å‘ç¥¨æŸ¥éªŒ

```xml
<?xml version="1.0" encoding="UTF-8"?>
<MSG>
  <VERSION>4.0.12</VERSION>
  <FPLX>01</FPLX>
  <FPDM>1100182130</FPDM>
  <FPHM>63516373</FPHM>
  <KPRQ>20251230</KPRQ>
  <FPJE>10000.00</FPJE>
  <JYM></JYM>
  <USERNAME>testuser01</USERNAME>
  <SENDTIME>20251230163000</SENDTIME>
  <SIGN>e10adc3949ba59abbe56e057f20f883e</SIGN>
</MSG>
```

#### ç¤ºä¾‹2ï¼šå¢å€¼ç¨ç”µå­æ™®é€šå‘ç¥¨æŸ¥éªŒ

```xml
<?xml version="1.0" encoding="UTF-8"?>
<MSG>
  <VERSION>4.0.12</VERSION>
  <FPLX>10</FPLX>
  <FPDM>044001600111</FPDM>
  <FPHM>20078888</FPHM>
  <KPRQ>20251230</KPRQ>
  <FPJE></FPJE>
  <JYM>617888</JYM>
  <USERNAME>testuser01</USERNAME>
  <SENDTIME>20251230163100</SENDTIME>
  <SIGN>a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6</SIGN>
</MSG>
```

#### ç¤ºä¾‹3ï¼šæ•°ç”µå‘ç¥¨ï¼ˆä¸“ç¥¨ï¼‰æŸ¥éªŒ

```xml
<?xml version="1.0" encoding="UTF-8"?>
<MSG>
  <VERSION>4.0.12</VERSION>
  <FPLX>09</FPLX>
  <FPDM></FPDM>
  <FPHM>12345678901234567890</FPHM>
  <KPRQ>20251230</KPRQ>
  <FPJE>11800.00</FPJE>
  <JYM></JYM>
  <USERNAME>testuser01</USERNAME>
  <SENDTIME>20251230163200</SENDTIME>
  <SIGN>9876543210abcdefghijklmnopqrstuv</SIGN>
</MSG>
```

---

## å…«ã€æ˜ å°„è½¬æ¢å®Œæ•´æµç¨‹

### 8.1 è¯·æ±‚å‚æ•°æ˜ å°„æµç¨‹

```
1. æ¥æ”¶æœ¬å…¬å¸APIè¯·æ±‚
   â†“
2. éªŒè¯è¯·æ±‚å¤´ (Authorization, X-Request-Id, X-Customer-Id)
   â†“
3. éªŒè¯è¯·æ±‚ä½“å‚æ•°ï¼ˆæ ¹æ®invoice_typeéªŒè¯å¿…å¡«å­—æ®µï¼‰
   â†“
4. æ ¹æ®X-Customer-IdæŸ¥è¯¢é•¿è½¯è´¦æˆ·é…ç½® (USERNAME, PASSWORD)
   â†“
5. æ„å»ºé•¿è½¯APIè¯·æ±‚å‚æ•°ï¼š
   - VERSION: å›ºå®š "4.0.12"
   - FPLX: æ˜ å°„ invoice_type â†’ FPLX (æ³¨æ„ç‰¹æ®Šæ˜ å°„å¦‚02â†’01, 08â†’20)
   - FPDM: ç›´æ¥æ˜ å°„ invoice_code
   - FPHM: ç›´æ¥æ˜ å°„ invoice_number
   - KPRQ: æ ¼å¼è½¬æ¢ issue_date (YYYY-MM-DD â†’ YYYYMMDD)
   - FPJE: ç±»å‹è½¬æ¢ invoice_amount (number â†’ string)
   - JYM: æˆªå– verification_code å6ä½
   - USERNAME: ä»é…ç½®è·å–
   - SENDTIME: ç”Ÿæˆå½“å‰æ—¶é—´ (YYYYMMDDHHmmss)
   - SIGN: è®¡ç®— MD5(USERNAME + FPDM + FPHM + SENDTIME + PASSWORD)
   â†“
6. æ„å»ºXMLæŠ¥æ–‡
   â†“
7. è°ƒç”¨é•¿è½¯API
   â†“
8. è§£æé•¿è½¯å“åº” (è§å“åº”å­—æ®µæ˜ å°„æ–‡æ¡£)
   â†“
9. æ„å»ºæœ¬å…¬å¸APIå“åº”
```

### 8.2 æ•°ç”µå‘ç¥¨ç‰¹æ®Šå¤„ç†

```
é’ˆå¯¹æ•°ç”µå‘ç¥¨ (invoice_type: 81-88, 51, 61):
1. è¯†åˆ«æ•°ç”µå‘ç¥¨ç±»å‹
   â†“
2. ç»Ÿä¸€æ˜ å°„ FPLX = "09"
   â†“
3. å“åº”è§£ææ—¶ï¼Œä» HEAD/QDLX è·å–å­ç±»å‹ï¼š
   - QDLX=20 â†’ invoice_type=81 (æ•°ç”µä¸“ç¥¨)
   - QDLX=10 â†’ invoice_type=82 (æ•°ç”µæ™®ç¥¨)
   - QDLX=03 â†’ invoice_type=83/87 (æ•°ç”µæœºåŠ¨è½¦)
   - QDLX=15 â†’ invoice_type=84/88 (æ•°ç”µäºŒæ‰‹è½¦)
   - QDLX=01 â†’ invoice_type=85 (æ•°ç”µçº¸è´¨ä¸“ç¥¨)
   - QDLX=04 â†’ invoice_type=86 (æ•°ç”µçº¸è´¨æ™®ç¥¨)
   â†“
4. åŒºåˆ†æ•°ç”µç”µå­(81-84)å’Œæ•°ç”µçº¸è´¨(85-88)ï¼š
   - æœ‰invoice_code â†’ çº¸è´¨
   - æ— invoice_code â†’ ç”µå­
```

---

## ä¹ã€é”™è¯¯å¤„ç†

### 9.1 å‚æ•°éªŒè¯é”™è¯¯

å½“è¯·æ±‚å‚æ•°ä¸ç¬¦åˆè¦æ±‚æ—¶ï¼Œæœ¬å…¬å¸APIåº”è¿”å› HTTP 400 é”™è¯¯ï¼š

```json
{
  "error": {
    "code": "invalid_request_parameter",
    "type": "validation_error",
    "message": "å‚æ•°éªŒè¯å¤±è´¥ï¼šå‘ç¥¨ä»£ç æ ¼å¼ä¸æ­£ç¡®",
    "details": {
      "field": "invoice_code",
      "value": "ABC123",
      "expected": "10ä½æˆ–12ä½æ•°å­—"
    }
  }
}
```

### 9.2 é•¿è½¯è®¤è¯é”™è¯¯

å½“é•¿è½¯è´¦æˆ·é…ç½®ç¼ºå¤±æˆ–ç­¾åé”™è¯¯æ—¶ï¼š

```json
{
  "error": {
    "code": "verification_channel_config_error",
    "type": "system_error",
    "message": "æŸ¥éªŒé€šé“é…ç½®é”™è¯¯ï¼Œè¯·è”ç³»ç³»ç»Ÿç®¡ç†å‘˜"
  }
}
```

å¯¹åº”é•¿è½¯é”™è¯¯ä»£ç ï¼š100ã€101ã€102ã€103ã€107

---

## åã€ç‰ˆæœ¬å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | ä¿®è®¢å†…å®¹ | ä½œè€… |
|------|------|---------|------|
| v1.0 | 2025-12-30 | åˆ›å»ºè¯·æ±‚å‚æ•°æ˜ å°„æ–‡æ¡£ï¼Œå®šä¹‰æœ¬å…¬å¸APIä¸é•¿è½¯APIè¯·æ±‚å‚æ•°æ˜ å°„å…³ç³» | Claude |

---

## åä¸€ã€å‚è€ƒæ–‡æ¡£

1. **é•¿è½¯APIæ–‡æ¡£**: `ã€é•¿è½¯ã€‘å‘ç¥¨æŸ¥éªŒæœåŠ¡è°ƒç”¨è¯´æ˜V4.0.16.pdf`
2. **æœ¬å…¬å¸APIå®šä¹‰**: [`/partners/invoice-verifications`](https://s.apifox.cn/2795ad32-31e7-4363-8294-578e8dc6202c/395314528e0)
3. **é€šç”¨æšä¸¾æ˜ å°„**: [00_é€šç”¨è¯´æ˜_æšä¸¾æ˜ å°„.md](./00_é€šç”¨è¯´æ˜_æšä¸¾æ˜ å°„.md)
4. **å„å‘ç¥¨ç±»å‹æ˜ å°„è¡¨**: `docs/mappings/` ç›®å½•ä¸‹å„æ–‡æ¡£

---

**æ–‡æ¡£ç»“æŸ**
