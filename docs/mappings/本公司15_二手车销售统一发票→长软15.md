# 本公司15_二手车销售统一发票→长软15 字段映射表

**文档版本**: v1.0
**创建日期**: 2025-12-30
**发票类型**: 15 - 二手车销售统一发票

---

## 📋 概述

本文档定义了本公司发票查验API与长软发票查验服务之间，针对"二手车销售统一发票"的完整字段映射关系。

- **本公司API**: [`/partners/invoice-verifications`](https://s.apifox.cn/2795ad32-31e7-4363-8294-578e8dc6202c/395314528e0) (RESTful JSON格式)
- **长软API**: 【长软】发票查验服务调用说明V4.0.16.pdf (XML格式)
- **本公司发票类型代码**: 15
- **长软发票类型代码**: 15
- **长软文档章节**: 3.2.3.8

### 依赖的通用文档

本映射表引用以下通用文档，使用前请先了解：
- 📄 [00_通用说明_请求参数映射.md](./00_通用说明_请求参数映射.md) - 查验请求参数映射
- 📄 [00_通用说明_枚举映射.md](./00_通用说明_枚举映射.md) - 通用枚举值映射（CYJGDM, ZFBZ等）

---

## 一、类型映射关系

| 项目 | 本公司API | 长软API | 说明 |
|------|-----------|---------|------|
| 发票类型代码 | `15` | `15` | 完全一致 |
| 发票类型名称 | 二手车销售统一发票 | 二手车销售统一发票 | |
| 数据结构定义 | `#/definitions/231697057` | `3.2.3.8` | |
| 数电发票类型 | - | - | 非数电发票 |

---

## 二、发票主信息字段映射

### 2.1 完整字段对照表

⚠️ **重要**: 本表格包含该发票类型的**所有响应字段**，请逐一核对。

| 本公司API字段路径 | 本公司API中文名 | 本公司API类型 | 长软API字段路径 | 长软API中文名 | 长软API类型 | 映射说明 |
|---|---|---|---|---|---|---|
| `invoice_code` | 发票代码 | string(12) | `BODY/FPDM` | 发票代码 | VARCHAR2(20) | 直接映射 |
| `invoice_number` | 发票号码 | string(20) | `BODY/FPHM` | 发票号码 | VARCHAR2(10) | 直接映射 |
| `paper_invoice_no` | 纸质发票号码 | string(8) | `BODY/FPHM` | 发票号码 | VARCHAR2(10) | 与invoice_number相同 |
| - | - | - | `BODY/CYCS` | 查验次数 | VARCHAR2(32) | **长软独有**，记录该发票被查验次数 |
| `issue_date` | 开票日期 | string(19) | `BODY/KPRQ` | 开票日期 | VARCHAR2(32) | 格式转换：YYYY-MM-DD ← YYYYMMDD |
| `tax_control_code` | 税控码 | string(32) | `BODY/SKPH` | 机器编码 | VARCHAR2(16) | 直接映射 |
| - | - | - | `BODY/CYSJ` | 查验时间 | VARCHAR2(20) | **长软独有**，查验时间戳 |
| `remark` | 备注 | string(610) | `BODY/BZ` | 备注 | VARCHAR2(610) | 直接映射 |
| `invoice_status` | 发票状态 | 枚举 | `HEAD/CYJGDM` | 查验结果代码 | VARCHAR(3) | **关键字段**，查验状态码，参见通用枚举文档 |
| - | - | - | `BODY/ZFBZ` | 作废标志 | CHAR(1) | **长软独有**，Y=作废，N=正常，参见通用枚举文档 |
| - | - | - | `BODY/FXKPBZ` | 反向开票标志 | VARCHAR2(2) | **长软独有**，0=否，1=是 |
| `tax_payer_id` | 报税纳税人识别号 | string(20) | - | - | - | **本公司独有**，开票企业纳税人识别号 |
| `issuer_tax_no` | 开票方纳税人识别号 | string(20) | - | - | - | **本公司独有**，与tax_payer_id相同 |
| `issuer` | 开票人 | string(150) | - | - | - | **本公司独有**，从业务系统获取 |
| `issue_type` | 开票类型 | 枚举 | - | - | - | **本公司独有**，仅乐企查验返回 |

**字段分类说明**：
- **直接映射**: 字段名和含义一致，直接对应
- **格式转换**: 需要进行格式转换（如日期、金额格式）
- **类型转换**: 需要进行数据类型转换（如string ↔ number）
- **长软独有**: 长软API独有字段，本公司API无此字段
- **本公司独有**: 本公司API独有字段，需从其他数据源获取或计算

### 2.2 买方信息字段映射

| 本公司API字段路径 | 本公司API中文名 | 本公司API类型 | 长软API字段路径 | 长软API中文名 | 长软API类型 | 映射说明 |
|---|---|---|---|---|---|---|
| `buyer_name` | 买方单位/个人名称 | string(300) | `BODY/GFDW` | 买方单位/个人 | VARCHAR2(300) | 直接映射 |
| `buyer_code` | 买方单位/个人代码 | string(20) | `BODY/GFHM` | 买方单位代码/身份证号 | VARCHAR2(64) | 直接映射，可能是税号或身份证号 |
| `buyer_address` | 买方单位/个人地址 | string(310) | `BODY/GFDZ` | 买方单位/个人住址 | VARCHAR2(310) | 直接映射 |
| `buyer_phone` | 买方单位/个人电话 | string(80) | `BODY/GFDH` | 买方电话 | VARCHAR2(80) | 直接映射 |

### 2.3 卖方信息字段映射

| 本公司API字段路径 | 本公司API中文名 | 本公司API类型 | 长软API字段路径 | 长软API中文名 | 长软API类型 | 映射说明 |
|---|---|---|---|---|---|---|
| `seller_name` | 卖方单位/个人名称 | string(300) | `BODY/XFDW` | 卖方单位/个人 | VARCHAR2(300) | 直接映射 |
| `seller_code` | 卖方单位/个人代码 | string(20) | `BODY/XFHM` | 卖方单位代码/身份证号 | VARCHAR2(64) | 直接映射，可能是税号或身份证号 |
| `seller_address` | 卖方单位/个人地址 | string(310) | `BODY/XFDZ` | 卖方单位/个人住址 | VARCHAR2(310) | 直接映射 |
| `seller_phone` | 卖方单位/个人电话 | string(80) | `BODY/XFDH` | 卖方电话 | VARCHAR2(80) | 直接映射 |

### 2.4 经营/拍卖单位信息字段映射

| 本公司API字段路径 | 本公司API中文名 | 本公司API类型 | 长软API字段路径 | 长软API中文名 | 长软API类型 | 映射说明 |
|---|---|---|---|---|---|---|
| `auction_company_name` | 经营、拍卖单位名称 | string(300) | `BODY/JYDW` | 经营、拍卖单位 | VARCHAR2(300) | 直接映射 |
| `auction_company_tax_no` | 经营、拍卖单位纳税人识别号 | string(20) | `BODY/JYSBH` | 经营、拍卖单位纳税人识别号 | VARCHAR2(26) | 直接映射 |
| `auction_company_address` | 经营、拍卖单位地址 | string(310) | `BODY/JYDZ` | 经营、拍卖单位地址 | VARCHAR2(310) | 直接映射 |
| `auction_company_bank_account` | 经营、拍卖单位开户行、账号 | string(250) | `BODY/JYYHZH` | 开户银行及账号 | VARCHAR2(250) | 直接映射 |
| `auction_company_phone` | 经营、拍卖单位电话 | string(80) | `BODY/JYDH` | 经营、拍卖单位电话 | VARCHAR2(80) | 直接映射 |

### 2.5 二手车市场信息字段映射

| 本公司API字段路径 | 本公司API中文名 | 本公司API类型 | 长软API字段路径 | 长软API中文名 | 长软API类型 | 映射说明 |
|---|---|---|---|---|---|---|
| `used_car_market_name` | 二手车市场名称 | string(300) | `BODY/SCMC` | 二手车市场 | VARCHAR2(300) | 直接映射 |
| `used_car_market_tax_no` | 二手车市场识别号 | string(20) | `BODY/SCSBH` | 二手车市场纳税人识别号 | VARCHAR2(26) | 直接映射 |
| `used_car_market_address` | 二手车市场地址 | string(310) | `BODY/SCDZ` | 二手车市场地址 | VARCHAR2(310) | 直接映射 |
| `used_car_market_bank_account` | 二手车市场开户行、账号 | string(250) | `BODY/SCYHZH` | 二手车市场开户银行及账号 | VARCHAR2(250) | 直接映射 |
| `used_car_market_phone` | 二手车市场电话 | string(80) | `BODY/SCDH` | 二手车市场电话 | VARCHAR2(80) | 直接映射 |

### 2.6 车辆信息字段映射

| 本公司API字段路径 | 本公司API中文名 | 本公司API类型 | 长软API字段路径 | 长软API中文名 | 长软API类型 | 映射说明 |
|---|---|---|---|---|---|---|
| `license_plate_no` | 车牌照号 | string(32) | `BODY/CPZH` | 车牌照号 | VARCHAR2(32) | 直接映射 |
| `registration_no` | 登记证号 | string(32) | `BODY/DJZH` | 登记证号 | VARCHAR2(32) | 直接映射 |
| `vehicle_type_code` | 车辆类型 | string(128) | `BODY/CLLX` | 车辆类型 | VARCHAR2(32) | 直接映射 |
| `vehicle_identification_no` | 车架号/车辆识别号 | string(64) | `BODY/CJHM` | 车辆识别代号/车架号码 | VARCHAR2(64) | 直接映射，VIN码 |
| `product_model` | 厂牌型号 | string(210) | `BODY/CPXH` | 厂牌型号 | VARCHAR2(96) | 直接映射 |
| `transfer_vehicle_management_name` | 转入地车辆管理所名称 | string(310) | `BODY/CGSMC` | 转入地车辆车管所名称 | VARCHAR2(310) | 直接映射 |
| `vehicle_price_total` | 车价合计 | number(18,2) | `BODY/CJHJ` | 车价合计 | VARCHAR2(32) | 类型转换：长软为字符串，**不含税价** |

### 2.7 本公司独有字段处理说明

| 本公司字段 | 数据来源 | 处理逻辑 |
|-----------|---------|----------|
| `tax_payer_id` | 业务系统 | 开票企业纳税人识别号，从业务系统获取 |
| `issuer_tax_no` | 业务系统 | 开票方纳税人识别号，与tax_payer_id相同 |
| `issuer` | 业务系统 | 开票人姓名，从业务系统获取 |
| `product_code` | 业务系统 | 商品编码（税收分类编码），二手车统一编码 |
| `custom_code` | 业务系统 | 纳税人自行编码 |
| `preferential_policy_flag` | 业务系统 | 优惠政策标识（0=无，1=有） |
| `zero_tax_rate_flag` | 业务系统 | 零税率标识枚举 |
| `vat_special_management` | 业务系统 | 增值税特殊管理说明 |
| `applicable_tax_rate_flag` | 业务系统 | 适用税率标识（1=是，其他=否） |
| `issue_type` | 乐企查验 | 开票类型，仅乐企查验接口返回 |

---

## 三、货物/明细字段映射

### 3.1 明细结构说明

⚠️ **注意**:
- ❌ **二手车销售统一发票无货物明细结构**
- 二手车发票是单笔交易，只有一个车价合计（不含税价）
- 车辆信息字段直接在发票主信息中，不在明细列表中
- **长软API无 `CHILDLIST` 节点**
- **本公司API无 `items[]` 数组**

### 3.2 与机动车发票的区别

| 项目 | 二手车发票 (15) | 机动车发票 (03) |
|------|---------------|---------------|
| 车价性质 | **不含税价** | 含税价 |
| 是否有税额 | ❌ 无单独税额字段 | ✅ 有税额、税率字段 |
| 涉及方数量 | 四方（买方、卖方、经营单位、二手车市场） | 两方（购方、销方） |
| 明细结构 | ❌ 无明细 | ❌ 无明细（只有车辆信息） |
| 反向开票标志 | ✅ 有（FXKPBZ） | ❌ 无 |

---

## 四、数据格式转换说明

### 4.1 日期格式转换

| API | 格式 | 示例 |
|-----|------|------|
| 本公司API | `YYYY-MM-DD` 或 `YYYY-MM-DD HH:mm:ss` | 2025-12-30 或 2025-12-30 16:59:45 |
| 长软API | `YYYYMMDD` | 20251230 |

**转换规则**：
```javascript
// 长软 → 本公司
function formatDate(yyyymmdd) {
  if (!yyyymmdd || yyyymmdd.length !== 8) return null;
  return `${yyyymmdd.substr(0,4)}-${yyyymmdd.substr(4,2)}-${yyyymmdd.substr(6,2)}`;
}
// 示例: "20251230" → "2025-12-30"
```

### 4.2 数值类型转换

| 数据项 | 本公司API | 长软API | 转换说明 |
|--------|-----------|---------|----------|
| 车价合计 | `number` (18,2) | `VARCHAR2(32)` 字符串 | 长软→本公司: `parseFloat()` |

**转换示例**：
```javascript
// 长软API返回
{
  "CJHJ": "150000.00"      // 车价合计（字符串，不含税价）
}

// 转换为本公司API
{
  "vehicle_price_total": 150000.00   // 不含税价
}
```

### 4.3 字符串长度适配

| 字段 | 本公司长度 | 长软长度 | 处理策略 |
|------|-----------|---------|----------|
| invoice_number | 20 | 10 | ✅ 本公司更宽松，兼容数电发票20位 |
| buyer_code | 20 | 64 | ⚠️ 长软更大，支持身份证18位或税号18位 |
| seller_code | 20 | 64 | ⚠️ 长软更大，支持身份证18位或税号18位 |
| auction_company_tax_no | 20 | 26 | ⚠️ 长软更大，但实际18位够用 |
| used_car_market_tax_no | 20 | 26 | ⚠️ 长软更大，但实际18位够用 |
| product_model | 210 | 96 | ⚠️ 本公司更大，实际96位足够 |
| vehicle_type_code | 128 | 32 | ⚠️ 本公司更大，实际32位足够 |

---

## 五、枚举值映射

### 5.1 通用枚举映射

通用枚举值详见: 📄 [00_通用说明_枚举映射.md](./00_通用说明_枚举映射.md)

包括：
- **查验结果代码** (CYJGDM → invoice_status)
- **作废标志** (ZFBZ → 本公司暂无直接对应字段，可从invoice_status推断)

### 5.2 二手车发票特有枚举映射

⚠️ **重要**: 以下枚举为**该发票类型特有**，不在通用枚举文档中。

#### 5.2.1 反向开票标志 (FXKPBZ)

**长软字段**: `BODY/FXKPBZ`
**本公司字段**: 暂无直接对应（可扩展为 `reverse_invoice_flag`）

| 长软值 | 含义 | 说明 |
|-------|------|------|
| 0 | 否 | 正常开票（买方开给卖方） |
| 1 | 是 | 反向开票（卖方开给买方） |

**业务含义**：
- 正常情况（0）：经营单位或二手车市场作为开票方，开给买方
- 反向开票（1）：买方作为开票方，开给卖方（特殊业务场景）

#### 5.2.2 买方/卖方代码类型识别

**长软字段**: `BODY/GFHM`、`BODY/XFHM`
**本公司字段**: `buyer_code`、`seller_code`

由于买方和卖方可能是个人，代码字段可能是以下两种类型之一：

| 类型 | 格式 | 长度 | 识别规则 |
|------|------|------|---------|
| 纳税人识别号（税号） | 纯数字 | 15位或18位 | 企业统一社会信用代码或税号 |
| 身份证号 | 数字+字母(X) | 18位 | 个人身份证号码 |

**识别逻辑**：
```javascript
function identifyCodeType(code) {
  if (!code) return null;

  // 去除空格
  code = code.trim();

  // 18位且包含字母X，可能是身份证
  if (code.length === 18 && /^\d{17}[\dXx]$/.test(code)) {
    return 'ID_CARD';  // 身份证号
  }

  // 15位或18位纯数字，可能是税号
  if ((code.length === 15 || code.length === 18) && /^\d+$/.test(code)) {
    return 'TAX_NO';   // 税号
  }

  return 'UNKNOWN';
}
```

---

## 六、二手车发票特殊性说明

### 6.1 该类型的独特特性

1. **四方主体结构**
   - **买方**：购买二手车的单位或个人
   - **卖方**：出售二手车的单位或个人
   - **经营/拍卖单位**：实际开票方（二手车经销商或拍卖公司）
   - **二手车市场**：提供交易场所的市场管理方

   这是二手车发票最显著的特点，涉及多方信息，与普通发票只有购销双方不同。

2. **车价合计为不含税价**
   - 二手车发票的 `CJHJ`（车价合计）是**不含税价**
   - 与机动车发票（03）不同，机动车发票的价税合计是含税价
   - 二手车销售适用简易计税方法，征收率0.5%，但发票上不显示税额

3. **买方/卖方可能是个人**
   - 买方或卖方的代码字段可能是税号（企业）或身份证号（个人）
   - 需要根据格式和长度判断代码类型
   - 个人信息字段标题统一为"单位/个人"

4. **反向开票机制**
   - 长软API有 `FXKPBZ`（反向开票标志）字段
   - 0=正常开票，1=反向开票
   - 正常情况下由经营单位或二手车市场开具
   - 特殊情况下可能由买方向卖方反向开票

5. **无货物明细结构**
   - 二手车发票是单笔交易，无明细列表
   - 车辆信息直接在发票主信息中
   - 长软API无 `CHILDLIST` 节点
   - 本公司API无 `items[]` 数组

6. **车辆信息完整**
   - 包含车牌照号、登记证号、车架号、厂牌型号等
   - 转入地车管所名称用于车辆过户
   - 车辆识别代号（VIN码）是车辆唯一标识

### 6.2 与其他类型的区别

| 特性 | 二手车发票(15) | 机动车发票(03) | 增值税专用发票(01) |
|------|--------------|--------------|------------------|
| 涉及主体 | 四方 | 两方 | 两方 |
| 车价性质 | 不含税价 | 含税价 | - |
| 是否显示税额 | ❌ 否 | ✅ 是 | ✅ 是 |
| 抵扣进项税 | ❌ 不可抵扣 | ✅ 可抵扣 | ✅ 可抵扣 |
| 明细结构 | ❌ 无明细 | ❌ 无明细 | ✅ 有货物明细 |
| 买方信息 | 可能是个人（身份证） | 可能是个人 | 必须是企业（税号） |
| 反向开票标志 | ✅ 有（FXKPBZ） | ❌ 无 | ❌ 无 |
| 特殊字段 | 经营单位、二手车市场 | 合格证号、进口证明 | 购销方完整信息 |

### 6.3 特殊处理逻辑

#### 6.3.1 四方主体信息提取

二手车发票涉及四方，需要分别提取各方信息：

**处理流程**：
1. **识别买方信息** - 从 `GFDW`、`GFHM`、`GFDZ`、`GFDH` 提取
2. **识别卖方信息** - 从 `XFDW`、`XFHM`、`XFDZ`、`XFDH` 提取
3. **识别经营单位信息** - 从 `JYDW`、`JYSBH`、`JYDZ`、`JYYHZH`、`JYDH` 提取
4. **识别二手车市场信息** - 从 `SCMC`、`SCSBH`、`SCDZ`、`SCYHZH`、`SCDH` 提取
5. **判断实际开票方** - 通常是经营单位或二手车市场，通过税控码（SKPH）所属单位判断

#### 6.3.2 买方/卖方代码类型识别

**挑战**：买方和卖方的代码字段可能是税号（企业）或身份证号（个人）。

**解决方案**：
1. 检查代码字段长度和格式
2. 18位且末位可能是X → 身份证号
3. 15位或18位纯数字 → 税号
4. 根据识别结果设置对应的数据类型标识

#### 6.3.3 车价合计处理

**重要**: 二手车发票的车价合计是**不含税价**。

**处理注意事项**：
1. `CJHJ` 字段直接映射为 `vehicle_price_total`
2. **不需要计算税额**（二手车发票不显示税额）
3. 实际征税采用简易计税，征收率0.5%，但不在发票上体现
4. 如果业务系统需要税额，计算公式：`税额 = 车价合计 × 0.5%`

#### 6.3.4 反向开票处理

当 `FXKPBZ = 1` 时，需要特殊处理：

**处理逻辑**：
1. 识别反向开票标志
2. 记录反向开票信息（可扩展字段）
3. 开票方信息可能在买方或卖方字段中
4. 需要根据业务规则确定实际的开票主体

---

## 七、集成注意事项

### 7.1 必填字段对比

**长软API要求必填**（核心字段）:
- `FPDM` (发票代码)
- `FPHM` (发票号码)
- `KPRQ` (开票日期)
- `GFDW` (买方单位/个人)
- `XFDW` (卖方单位/个人)
- `CJHJ` (车价合计)

**本公司API要求必填**:
- `invoice_status` (发票状态) - 从HEAD/CYJGDM映射，必填

### 7.2 字段长度差异

| 字段 | 本公司长度 | 长软长度 | 实际风险评估 |
|------|-----------|---------|------------|
| invoice_number | 20 | 10 | ✅ 本公司长度更大，兼容数电票号 |
| buyer_code | 20 | 64 | ⚠️ 长软更大，需考虑身份证18位，本公司20位可能不够 |
| seller_code | 20 | 64 | ⚠️ 长软更大，需考虑身份证18位，本公司20位可能不够 |
| auction_company_tax_no | 20 | 26 | ⚠️ 长软更大，但实际税号18位足够 |
| used_car_market_tax_no | 20 | 26 | ⚠️ 长软更大，但实际税号18位足够 |
| product_model | 210 | 96 | ✅ 本公司更大，无风险 |
| vehicle_type_code | 128 | 32 | ✅ 本公司更大，无风险 |

**风险提示**：
- `buyer_code` 和 `seller_code` 定义为20位，但实际身份证号18位，税号18位，20位勉强够用
- 建议扩展为64位以完全兼容长软API

### 7.3 数据完整性

**长软独有字段**（本公司API无对应）:
- `CYCS` (查验次数) - 长软统计查验次数，可记录但不返回
- `CYSJ` (查验时间) - 长软查验时间戳，可记录但不返回
- `ZFBZ` (作废标志) - 可映射到invoice_status或扩展字段
- `FXKPBZ` (反向开票标志) - 可扩展字段 `reverse_invoice_flag`

**本公司独有字段**（需从其他数据源获取）:
- `tax_payer_id` (报税纳税人识别号) - 从业务系统获取，开票企业税号
- `issuer_tax_no` (开票方纳税人识别号) - 与tax_payer_id相同
- `issuer` (开票人) - 从业务系统获取
- `product_code` (商品编码) - 二手车统一使用特定税收分类编码
- `custom_code` (纳税人自行编码) - 从业务系统获取
- `preferential_policy_flag` (优惠政策标识) - 从业务系统获取
- `zero_tax_rate_flag` (零税率标识) - 从业务系统获取
- `vat_special_management` (增值税特殊管理) - 从业务系统获取
- `applicable_tax_rate_flag` (适用税率标识) - 从业务系统获取
- `issue_type` (开票类型) - 仅乐企查验返回

### 7.4 二手车发票特殊集成要点

⚠️ **这是最重要的部分，必须根据业务特性详细说明！**

#### 7.4.1 四方主体信息完整性验证

**挑战**：二手车发票涉及买方、卖方、经营单位、二手车市场四方，信息复杂。

**解决方案**：
1. **验证必填方信息**：
   - 买方名称（GFDW）必填
   - 卖方名称（XFDW）必填
   - 经营单位或二手车市场至少一方必填

2. **识别实际开票方**：
   - 通过税控码（SKPH）所属单位判断
   - 通常是经营单位（JYDW）或二手车市场（SCMC）
   - 开票方的税号应与 `tax_payer_id` 一致

3. **处理个人信息**：
   - 买方或卖方可能是个人
   - 代码字段使用身份证号而非税号
   - 需要识别并正确处理身份证号格式

#### 7.4.2 车价合计验证（不含税价）

**挑战**：确保车价合计字段正确处理为不含税价。

**解决方案**：
1. 直接映射 `CJHJ` → `vehicle_price_total`
2. **不计算税额**（二手车发票不显示税额）
3. 如果业务需要，可单独计算：`税额 = vehicle_price_total × 0.005`
4. 车价合计通常较大（数万至数百万），需验证数值合理性

**验证规则**：
```javascript
// 二手车车价合理性验证
if (vehicle_price_total < 1000 || vehicle_price_total > 10000000) {
  console.warn('车价合计异常，请核实');
}
```

#### 7.4.3 买方/卖方代码类型识别

**挑战**：买方和卖方的代码可能是税号（企业）或身份证号（个人）。

**解决方案**：
1. 实现代码类型识别函数（参见5.2.2节）
2. 根据识别结果设置数据类型标识
3. 在数据库中记录代码类型，便于后续处理
4. 如果是身份证号，需注意隐私保护（脱敏处理）

**扩展字段建议**：
```javascript
{
  "buyer_code": "110101199001011234",
  "buyer_code_type": "ID_CARD",  // 扩展字段，标识代码类型

  "seller_code": "91110000123456789X",
  "seller_code_type": "TAX_NO"   // 扩展字段，标识代码类型
}
```

#### 7.4.4 反向开票标志处理

**挑战**：长软API有反向开票标志（FXKPBZ），本公司API暂无对应字段。

**解决方案**：
1. 在数据库中记录 `FXKPBZ` 值
2. 如果需要返回给用户，可扩展字段 `reverse_invoice_flag`
3. 当 `FXKPBZ=1` 时，需要识别实际开票方可能与常规情况不同

**扩展字段映射**：
| 长软FXKPBZ | 本公司reverse_invoice_flag | 说明 |
|-----------|--------------------------|------|
| 0 | 0 或 null | 正常开票 |
| 1 | 1 | 反向开票 |

#### 7.4.5 车辆信息完整性

**关键车辆字段**：
- `license_plate_no` (车牌照号) - 唯一标识，可能为空（新车未上牌）
- `registration_no` (登记证号) - 重要证件号
- `vehicle_identification_no` (车架号/VIN码) - **最重要**，全球唯一
- `product_model` (厂牌型号) - 车辆基本信息
- `transfer_vehicle_management_name` (转入地车管所) - 过户信息

**验证建议**：
1. 车架号（VIN码）必须17位
2. 车牌照号格式：省份简称+字母+5位数字/字母
3. 如果车牌照号为空，可能是新车，需特别标注

#### 7.4.6 税控码处理

**字段映射**：`BODY/SKPH` → `tax_control_code`

**业务含义**：
- 税控码（机器编码）标识开票税控设备
- 可通过税控码追溯实际开票单位
- 用于防伪和税务稽查

---

## 参考文档

1. 本公司API定义: [`/partners/invoice-verifications`](https://s.apifox.cn/2795ad32-31e7-4363-8294-578e8dc6202c/395314528e0) (Definition ID: 231697057)
2. 长软API文档: `【长软】发票查验服务调用说明V4.0.16.pdf` (3.2.3.8节)
3. 通用枚举映射: `00_通用说明_枚举映射.md`
4. 通用请求参数映射: `00_通用说明_请求参数映射.md`
5. 国家税务总局发票查验平台: https://inv-veri.chinatax.gov.cn/

---

**文档结束**
