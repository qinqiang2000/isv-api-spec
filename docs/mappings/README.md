# 发票查验API映射表 - 总览与导航

**文档版本**: v1.0
**创建日期**: 2025-12-30
**适用范围**: 本公司发票查验API ↔ 长软发票查验服务

---

## 📚 文档概述

本目录包含本公司发票查验API与长软发票查验服务之间的完整字段映射关系文档。这些文档用于指导开发人员实现两个系统之间的数据转换与集成。

### 系统架构

```
用户/业务系统
    ↓ 调用
本公司发票查验API (RESTful JSON)
    ↓ 转换映射
长软发票查验服务 (SOAP XML)
    ↓
返回查验结果
```

### 接口对比

| 维度 | 本公司API | 长软API |
|------|-----------|---------|
| 定义文档 | [`/partners/invoice-verifications`](https://s.apifox.cn/2795ad32-31e7-4363-8294-578e8dc6202c/395314528e0) | `【长软】发票查验服务调用说明V4.0.16.pdf` |
| 协议 | HTTP REST | HTTP POST |
| 格式 | JSON | XML |
| 发票类型数 | 19个 (01,02,03,04,08,10,11,14,15,51,61,81-88,F1) | 12个基础类型 (01,03,04,10,11,14,15,20,09,83,61,72) |

---

## 🗺️ 发票类型映射关系总表

这是最核心的映射关系，决定了如何路由发票查验请求。

### 一对一映射（传统发票）

| 本公司类型 | 长软类型 | 发票类型名称 | 文档链接 |
|-----------|---------|------------|---------|
| **01** | **01** | 增值税专用发票 | [本公司01_增值税专用发票→长软01.md](./本公司01_增值税专用发票→长软01.md) |
| **02** | **01** | 货物运输业增值税专用发票 | ⚠️ 与01共用 |
| **03** | **03** | 机动车销售统一发票 | [本公司03_机动车销售统一发票→长软03.md](./本公司03_机动车销售统一发票→长软03.md) |
| **04** | **04** | 增值税普通发票 | [本公司04_增值税普通发票→长软04.md](./本公司04_增值税普通发票→长软04.md) |
| **08** | **20** | 增值税电子专用发票 | [本公司08_增值税电子专用发票→长软20.md](./本公司08_增值税电子专用发票→长软20.md) |
| **10** | **10** | 增值税电子普通发票 | [本公司10_增值税电子普通发票→长软10.md](./本公司10_增值税电子普通发票→长软10.md) |
| **11** | **11** | 增值税普通发票（卷式） | [本公司11_增值税普通发票（卷式）→长软11.md](./本公司11_增值税普通发票（卷式）→长软11.md) |
| **14** | **14** | 增值税普通发票（通行费） | [本公司14_增值税普通发票（通行费）→长软14.md](./本公司14_增值税普通发票（通行费）→长软14.md) |
| **15** | **15** | 二手车销售统一发票 | [本公司15_二手车销售统一发票→长软15.md](./本公司15_二手车销售统一发票→长软15.md) |
| **51** | **83** | 铁路电子客票 | [本公司51_铁路电子客票→长软83.md](./本公司51_铁路电子客票→长软83.md) |
| **61** | **61** | 航空运输客票电子行程单 | [本公司61_电子发票（航空运输客票电子行程单）→长软61.md](./本公司61_电子发票（航空运输客票电子行程单）→长软61.md) |

### 一对多映射（数电发票 - 长软09）

⚠️ **关键概念**: 长软将所有数电发票统一归为类型码 **09**，通过 `QDLX` 字段区分子类型。

| 本公司类型 | 长软类型 | QDLX值 | 发票类型名称 | 文档链接 |
|-----------|---------|-------|------------|---------|
| **81** | **09** | **20** | 数电发票（增值税专用发票） | [本公司81_数电专票→长软09(QDLX=20).md](./本公司81_数电专票→长软09(QDLX=20).md) |
| **82** | **09** | **10** | 数电发票（普通发票） | [本公司82_数电普票→长软09(QDLX=10).md](./本公司82_数电普票→长软09(QDLX=10).md) |
| **83** | **09** | **03** | 数电机动车销售电子统一发票 | [本公司83_机动车销售电子统一发票→长软09(QDLX=03).md](./本公司83_机动车销售电子统一发票→长软09(QDLX=03).md) |
| **84** | **09** | **15** | 数电二手车销售统一发票 | [本公司84_数电二手车→长软09(QDLX=15).md](./本公司84_数电二手车→长软09(QDLX=15).md) |
| **85** | **09** | **01** | 数电纸质发票（增值税专用发票） | [本公司85_纸质发票(增值税专用发票)→长软09(QDLX=01).md](./本公司85_纸质发票(增值税专用发票)→长软09(QDLX=01).md) |
| **86** | **09** | **04** | 数电纸质发票（普通发票） | [本公司86_数电纸质发票(普通发票)→长软09(QDLX=04).md](./本公司86_数电纸质发票(普通发票)→长软09(QDLX=04).md) |
| **87** | **09** | **03** | 数电纸质发票（机动车销售统一发票） | [本公司87_数电纸质发票(机动车销售统一发票)→长软09(QDLX=03).md](./本公司87_数电纸质发票(机动车销售统一发票)→长软09(QDLX=03).md) |
| **88** | **09** | **15** | 数电纸质发票（二手车销售统一发票） | [本公司88_数电纸质发票(二手车销售统一发票)→长软09(QDLX=15).md](./本公司88_数电纸质发票(二手车销售统一发票)→长软09(QDLX=15).md) |

**数电发票特殊性说明**：
- 🔑 **QDLX（全电类型）**: 长软用此字段区分09类型下的不同子类型
- 📄 **无发票代码**: 数电发票（81-84）没有12位发票代码，仅有20位发票号码
- 🔢 **双重查验**: 数电纸质发票（85-88）既有纸质号码（8位）也有数电号码（20位），某些类型支持两种查验方式

### 特殊发票类型

| 本公司类型 | 查验平台 | 发票类型名称 | 说明 |
|-----------|---------|------------|------|
| **F1** | 财政部平台 | 财政电子票据 | ⚠️ **不通过长软查验** |

---

## 📖 文档导航

### 必读文档（通用）

这些文档定义了所有发票类型共享的映射规则，**必须优先阅读**：

1. **[00_通用说明_请求参数映射.md](./00_通用说明_请求参数映射.md)**
   - 请求参数（发票代码、发票号码、开票日期等）映射规则
   - 认证参数处理
   - 数据格式转换（日期、金额、校验码）
   - 不同发票类型的必填参数差异

2. **[00_通用说明_枚举映射.md](./00_通用说明_枚举映射.md)**
   - 查验结果代码（CYJGDM）映射
   - 发票状态/作废标志（ZFBZ）映射
   - 特殊票种标志（TSPZBZ）映射
   - 其他通用枚举值

### 类型特定文档（按需查阅）

根据需要对接的发票类型，查阅对应的映射表文档：

#### 传统纸质发票
- [本公司01_增值税专用发票→长软01.md](./本公司01_增值税专用发票→长软01.md)
- [本公司03_机动车销售统一发票→长软03.md](./本公司03_机动车销售统一发票→长软03.md)
- [本公司04_增值税普通发票→长软04.md](./本公司04_增值税普通发票→长软04.md)
- [本公司11_增值税普通发票（卷式）→长软11.md](./本公司11_增值税普通发票（卷式）→长软11.md)
- [本公司14_增值税普通发票（通行费）→长软14.md](./本公司14_增值税普通发票（通行费）→长软14.md)
- [本公司15_二手车销售统一发票→长软15.md](./本公司15_二手车销售统一发票→长软15.md)

#### 传统电子发票
- [本公司08_增值税电子专用发票→长软20.md](./本公司08_增值税电子专用发票→长软20.md)
- [本公司10_增值税电子普通发票→长软10.md](./本公司10_增值税电子普通发票→长软10.md)

#### 数电发票（全电子）
- [本公司81_数电专票→长软09(QDLX=20).md](./本公司81_数电专票→长软09(QDLX=20).md)
- [本公司82_数电普票→长软09(QDLX=10).md](./本公司82_数电普票→长软09(QDLX=10).md)
- [本公司83_机动车销售电子统一发票→长软09(QDLX=03).md](./本公司83_机动车销售电子统一发票→长软09(QDLX=03).md)
- [本公司84_数电二手车→长软09(QDLX=15).md](./本公司84_数电二手车→长软09(QDLX=15).md)

#### 数电纸质发票
- [本公司85_纸质发票(增值税专用发票)→长软09(QDLX=01).md](./本公司85_纸质发票(增值税专用发票)→长软09(QDLX=01).md)
- [本公司86_数电纸质发票(普通发票)→长软09(QDLX=04).md](./本公司86_数电纸质发票(普通发票)→长软09(QDLX=04).md)
- [本公司87_数电纸质发票(机动车销售统一发票)→长软09(QDLX=03).md](./本公司87_数电纸质发票(机动车销售统一发票)→长软09(QDLX=03).md)
- [本公司88_数电纸质发票(二手车销售统一发票)→长软09(QDLX=15).md](./本公司88_数电纸质发票(二手车销售统一发票)→长软09(QDLX=15).md)

#### 客票类发票
- [本公司51_铁路电子客票→长软83.md](./本公司51_铁路电子客票→长软83.md)
- [本公司61_电子发票（航空运输客票电子行程单）→长软61.md](./本公司61_电子发票（航空运输客票电子行程单）→长软61.md)

### 参考文档

- **[TEMPLATE_发票映射表模板.md](./TEMPLATE_发票映射表模板.md)** - 用于创建新的发票类型映射表（仅供内部使用）

---

## 🚀 快速开始指南

### 场景1: 新人入门

1. **阅读顺序**:
   - ① [TEMPLATE_发票映射表模板.md](./TEMPLATE_发票映射表模板.md) 第一、二章 → 了解项目背景和文档组织
   - ② [00_通用说明_请求参数映射.md](./00_通用说明_请求参数映射.md) → 理解请求参数映射
   - ③ [00_通用说明_枚举映射.md](./00_通用说明_枚举映射.md) → 理解枚举值映射
   - ④ [本公司01_增值税专用发票→长软01.md](./本公司01_增值税专用发票→长软01.md) → 学习完整映射示例

2. **关键概念理解**:
   - 本公司API使用JSON格式，长软API使用XML格式
   - 发票类型映射：本公司19种类型 → 长软12种基础类型
   - 数电发票统一使用长软类型09，通过QDLX区分子类型

### 场景2: 对接特定发票类型

**示例：对接数电专票（类型81）**

1. 查看 [发票类型映射关系总表](#一对多映射数电发票---长软09) 确认映射：
   - 本公司类型81 → 长软类型09，QDLX=20

2. 阅读通用文档：
   - [00_通用说明_请求参数映射.md](./00_通用说明_请求参数映射.md) - 了解请求参数
   - [00_通用说明_枚举映射.md](./00_通用说明_枚举映射.md) - 了解枚举映射

3. 阅读类型特定文档：
   - [本公司81_数电专票→长软09(QDLX=20).md](./本公司81_数电专票→长软09(QDLX=20).md)

4. 关注特殊性：
   - 数电专票无发票代码（invoice_code为空）
   - 发票号码为20位数字
   - 四方信息（地址、电话、银行账号）可能为空
   - 响应中需要检查HEAD/QDLX=20来确认子类型

### 场景3: 生产对接开发

**前提**：AI工具或开发人员需要读取的最小文档集：

```
对接增值税专用发票(01):
├── 00_通用说明_请求参数映射.md      (请求参数)
├── 00_通用说明_枚举映射.md           (枚举值)
└── 本公司01_增值税专用发票→长软01.md  (完整字段映射)
```

**只需3个文档**即可生成准确的生产对接代码。

---

## 🔑 关键概念说明

### 数电发票（全电发票）

**定义**: 数字化电子发票，由国家税务总局推出的全面数字化的电子发票。

**特点**:
- 📄 无纸质发票代码，仅有20位发票号码
- 🔒 无校验码，防伪依赖电子签名
- 🖥️ 无税控设备，通过电子税务局开具
- 📝 四方信息简化（地址、电话、银行账号可为空）

**类型**:
- **数电电子发票** (81-84): 纯电子形式，无纸质票面
- **数电纸质发票** (85-88): 打印后的数电发票，同时有纸质号码（8位）和数电号码（20位）

### QDLX（全电类型）

**定义**: 长软API中用于区分数电发票子类型的字段。

**位置**: XML响应的 `HEAD/QDLX`

**取值**:
- **20**: 数电专用发票
- **10**: 数电普通发票
- **01**: 数电纸质专用发票
- **04**: 数电纸质普通发票
- **03**: 数电机动车发票（纸质或电子）
- **15**: 数电二手车发票（纸质或电子）

**使用场景**:
当长软返回 `FPLX=09` 时，必须根据 `QDLX` 值判断具体的发票子类型。

### 发票代码 vs 发票号码

| 项目 | 发票代码 | 发票号码 |
|------|---------|---------|
| **字段名** | invoice_code / FPDM | invoice_number / FPHM |
| **长度** | 10位或12位 | 8位（传统）或20位（数电） |
| **是否必填** | 传统发票必填，数电发票无此字段 | 所有发票必填 |
| **作用** | 标识发票印制批次 | 唯一标识一张发票 |
| **示例** | `1100182130`（10位）<br>`044001600111`（12位） | `63516373`（8位传统）<br>`12345678901234567890`（20位数电） |

### 四方信息

**定义**: 发票中购买方和销售方的详细信息，包括：
- 名称、税号（必需）
- 地址、电话（传统发票必需，数电发票可选）
- 开户行、账号（传统发票必需，数电发票可选）

**数电发票的简化**:
数电发票通常只包含购销双方的名称和税号，地址电话和银行账号字段为空。

---

## 📊 文档统计

| 分类 | 文档数量 | 说明 |
|------|---------|------|
| 通用说明文档 | 2 | 请求参数映射、枚举映射 |
| 传统纸质发票映射表 | 6 | 01, 03, 04, 11, 14, 15 |
| 传统电子发票映射表 | 2 | 08, 10 |
| 数电电子发票映射表 | 4 | 81, 82, 83, 84 |
| 数电纸质发票映射表 | 4 | 85, 86, 87, 88 |
| 客票类发票映射表 | 2 | 51, 61 |
| 参考模板 | 1 | TEMPLATE文档 |
| **总计** | **21** | - |

---

## ⚙️ 集成实施建议

### 开发阶段

1. **接口层实现**
   - 基于 [00_通用说明_请求参数映射.md](./00_通用说明_请求参数映射.md) 实现请求参数转换
   - 实现XML报文构建与解析

2. **类型路由实现**
   - 根据 `invoice_type` 路由到对应的映射处理器
   - 特别注意数电发票（09类型）的QDLX判断逻辑

3. **字段映射实现**
   - 针对每种发票类型，按对应映射表实现字段转换
   - 注意处理本公司独有字段（需要计算或从业务系统获取）

4. **枚举值处理**
   - 统一实现通用枚举映射（CYJGDM, ZFBZ, TSPZBZ等）
   - 每个类型的特有枚举单独处理

### 测试阶段

**推荐测试覆盖**:
- ✅ 每种发票类型至少1个正常案例
- ✅ 专票的农产品收购发票（TSPZBZ=04）反向映射
- ✅ 数电发票的QDLX识别
- ✅ 金额计算验证（价税合计 = 金额 + 税额）
- ✅ 红字发票处理
- ✅ 异常场景（查验失败、网络超时等）

### 运维阶段

**监控指标**:
- 查验成功率（按发票类型统计）
- 响应时间（P50, P95, P99）
- 长软API错误码分布
- 字段映射异常日志

---

## 🔗 相关资源

### 源文档

- **本公司API定义**: [`/partners/invoice-verifications`](https://s.apifox.cn/2795ad32-31e7-4363-8294-578e8dc6202c/395314528e0)
- **长软API文档**: `【长软】发票查验服务调用说明V4.0.16.pdf`

### 外部链接

- 国家税务总局发票查验平台: https://inv-veri.chinatax.gov.cn/
- 国家税务总局全电发票平台: https://etax.chinatax.gov.cn/

---

## 📝 版本历史

| 版本 | 日期 | 修订内容 | 作者 |
|------|------|---------|------|
| v1.0 | 2025-12-30 | 创建总览文档，包含发票类型映射总表、文档导航、快速开始指南 | Claude |

---

## 📮 反馈与支持

如对映射表有疑问或发现错误，请联系技术团队。

**文档结束**
