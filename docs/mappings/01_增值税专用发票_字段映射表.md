# 01-增值税专用发票 字段映射表

**文档版本**: v1.1
**创建日期**: 2025-12-29
**发票类型**: 01 - 增值税专用发票

## 概述

本文档定义了本公司发票查验API与长软发票查验服务之间，针对"01-增值税专用发票"的字段映射关系。

- **本公司API**: invoice_verification.apifox.json (RESTful JSON格式)
- **长软API**: 【长软】发票查验服务调用说明V4.0.16.pdf (XML格式)

---

## 一、发票主信息字段映射

| 本公司API字段路径 | 本公司API中文名 | 本公司API类型 | 长软API字段路径 | 长软API中文名 | 长软API类型 | 映射说明 |
|---|---|---|---|---|---|---|
| `invoice_code` | 发票代码 | string(12) | `BODY/FPDM` | 发票代码 | VARCHAR2(20) | 直接映射 |
| `invoice_number` | 发票号码 | string(20) | `BODY/FPHM` | 发票号码 | VARCHAR2(10) | 直接映射 |
| `issue_date` | 开票日期 | string(19) | `BODY/KPRQ` | 开票日期 | VARCHAR2(32) | 格式转换：本公司YYYY-MM-DD，长软YYYYMMDD |
| - | - | - | `BODY/CYCS` | 查验次数 | VARCHAR2(32) | **长软独有**，记录该发票被查验次数 |
| `seller_name` | 销售方名称 | string(300) | `BODY/XFMC` | 销方名称 | VARCHAR2(300) | 直接映射 |
| `seller_tax_no` | 销售方识别号 | string(20) | `BODY/XFSBH` | 销方纳税人识别号 | VARCHAR2(26) | 直接映射 |
| `seller_address_phone` | 销售方地址电话 | string(190) | `BODY/XFDZDH` | 销方地址电话 | VARCHAR2(120) | 长软格式："地址 电话"空格分隔 |
| `seller_bank_account` | 销售方银行账号 | string(300) | `BODY/XFYHZH` | 销方开户行及账号 | VARCHAR2(120) | 长软格式："开户行 账号"空格分隔 |
| `buyer_name` | 购买方名称 | string(300) | `BODY/GFMC` | 购方名称 | VARCHAR2(300) | 直接映射 |
| `buyer_tax_no` | 购买方税号 | string(20) | `BODY/GFSBH` | 购方纳税人识别号 | VARCHAR2(64) | 直接映射 |
| `buyer_address_phone` | 购买方地址电话 | string(190) | `BODY/GFDZDH` | 购方地址、电话 | VARCHAR2(120) | 长软格式："地址 电话"空格分隔 |
| `buyer_bank_account` | 购买方银行账号 | string(300) | `BODY/GFYHZH` | 购方开户行及账号 | VARCHAR2(120) | 长软格式："开户行 账号"空格分隔 |
| `amount` | 金额 | number(18,2) | `BODY/JE` | 金额合计 | VARCHAR2(32) | 类型转换：长软为字符串 |
| `tax_amount` | 税额 | number(18,2) | `BODY/SE` | 税额合计 | VARCHAR2(32) | 类型转换：长软为字符串 |
| `total_amount` | 价税合计 | number(18,2) | `BODY/JSHJ` | 价税合计 | VARCHAR2(32) | 类型转换：长软为字符串 |
| `remark` | 备注 | string(610) | `BODY/BZ` | 备注 | VARCHAR2(610) | 直接映射 |
| - | - | - | `BODY/JQBH` | 机器编号 | VARCHAR2(16) | **长软独有**，税控设备编号 |
| `verification_code` | 校验码 | string(32) | `BODY/JYM` | 校验码 | VARCHAR2(32) | 直接映射 |
| `invoice_status_flag` | 作废标志 | 枚举 | `BODY/ZFBZ` | 作废标志 | VARCHAR2(2) | 枚举映射：参见附录 |
| -                           | -                        | -             | `BODY/CPYBZ` | 成品油标志 | VARCHAR2(2) | **已废止**，应使用TSPZBZ |
| - | - | - | `BODY/CYSJ` | 查验时间 | VARCHAR2(20) | **长软独有**，查验时间戳 |
| - | - | - | `BODY/QDBZ` | 清单标志 | VARCHAR2(2) | **长软独有**，标识是否有清单 |
| `special_invoice_type` | 特殊票种 | 枚举 | `BODY/TSPZBZ` | 特殊票种标志 | VARCHAR2(2) | 枚举映射：参见附录 |
| - | - | - | `BODY/HZDK` | 汇总代开标志 | VARCHAR2(2) | **长软独有**，标识是否汇总代开 |
| `invoice_status` | 发票状态 | 枚举 | `HEAD/CYJGDM` | 查验结果代码 | VARCHAR(3) | **关键字段**，查验状态码，参见附录 |
| `void_date` | 作废日期 | string(19) | - | - | - | **本公司独有** |
| `tax_rate` | 税率 | number(8,5) | - | - | - | **本公司独有**，主单据税率 |
| `proxy_seller_tax_no` | 代开发票真实销售方识别号 | string(20) | - | - | - | **本公司独有** |
| `proxy_seller_name` | 代开发票真实销售方名称 | string(300) | - | - | - | **本公司独有** |
| `tax_inclusive_rate_flag` | 含税税率标识 | string(1) | - | - | - | **本公司独有** |
| `applicable_tax_rate_flag` | 适用税率标识 | string(1) | - | - | - | **本公司独有** |
| `item_count` | 明细条数 | string(30) | - | - | - | **本公司独有** |
| `non_taxable_amount` | 不征税金额 | number(18,2) | - | - | - | **本公司独有** |
| `seller_taxpayer_type_code` | 销方纳税人类型代码 | string(1) | - | - | - | **本公司独有** |
| `vehicle_abnormal_flag` | 机动车异常标识 | string(1) | - | - | - | **本公司独有** |
| `issue_type` | 开票类型 | 枚举 | - | - | - | **本公司独有** |

---

## 二、货物明细字段映射

### 本公司API路径: `items[]`
### 长软API路径: `BODY/CHILDLIST/CHILD[]`

| 本公司API字段 | 本公司API中文名 | 本公司API类型 | 长软API字段 | 长软API中文名 | 长软API类型 | 映射说明 |
|---|---|---|---|---|---|---|
| `sequence_no` | 货物明细序号 | integer | - | - | - | **本公司独有**，用于排序 |
| `name` | 货物名称 | string(310) | `HWMC` | 货物或应税劳务名称 | VARCHAR2(320) | 直接映射 |
| `specification` | 规格型号 | string(64) | `GGXH` | 规格型号 | VARCHAR2(64) | 直接映射 |
| `unit` | 计量单位 | string(52) | `DW` | 单位 | VARCHAR2(52) | 直接映射 |
| `quantity` | 数量 | string(25) | `SL` | 数量 | VARCHAR2(25) | 直接映射 |
| `unit_price` | 单价 | string(25) | `DJ` | 单价 | VARCHAR2(25) | 直接映射 |
| `tax_rate` | 税率 | number(8,5) | `SLV` | 税率 | NUMBER(8,5) | 直接映射 |
| `tax_amount` | 税额 | number(18,2) | `SE` | 税额 | NUMBER(20,2) | 精度略有差异 |
| `amount` | 金额 | number(18,2) | `JE` | 金额 | NUMBER(20,2) | 精度略有差异 |
| `product_code` | 商品编码 | string(45) | `SPBM` | 商品编码 | - | 长软XML样例中存在，但文档表中未列出 |
| `zero_tax_rate_flag` | 零税率标志 | 枚举 | - | - | - | **本公司独有** |

---

## 三、数据格式转换说明

### 3.1 日期格式

| API | 格式 | 示例 |
|---|---|---|
| 本公司API | YYYY-MM-DD 或 YYYY-MM-DD HH:mm:ss | 2025-12-29 或 2025-12-29 16:59:45 |
| 长软API | YYYYMMDD | 20251229 |

**转换规则**：
- 本公司 → 长软：移除日期分隔符，截取前8位
- 长软 → 本公司：插入"-"分隔符

### 3.2 数值类型

| 数据项 | 本公司API | 长软API | 转换说明 |
|---|---|---|---|
| 金额、税额 | number (18,2) | VARCHAR2(32) | 长软使用字符串，需要类型转换 |
| 价税合计 | number (18,2) | VARCHAR2(32) | 长软使用字符串，需要类型转换 |
| 税率 | number (8,5) | NUMBER(8,5) | 类型一致 |

### 3.3 XML与JSON结构差异

**长软API (XML结构)**:
```xml
<MSG>
  <HEAD>
    <FPLX>01</FPLX>
    <FPDM>6100221130</FPDM>
    <FPHM>07804189</FPHM>
    <CYJGDM>001</CYJGDM>
  </HEAD>
  <BODY>
    <FPDM>6100221130</FPDM>
    <FPHM>07804189</FPHM>
    <GFMC>购方名称</GFMC>
    <XFMC>销方名称</XFMC>
    <JE>5486725.66</JE>
    <SE>713274.34</SE>
    <JSHJ>6200000.00</JSHJ>
    <CHILDLIST>
      <CHILD>
        <HWMC>货物名称</HWMC>
        <JE>2566371.68</JE>
        <SE>333628.32</SE>
      </CHILD>
    </CHILDLIST>
  </BODY>
</MSG>
```

**本公司API (JSON结构)**:
```json
{
  "invoice_type": "01",
  "invoice_code": "6100221130",
  "invoice_number": "07804189",
  "invoice_status": "001",
  "buyer_name": "购方名称",
  "seller_name": "销方名称",
  "amount": 5486725.66,
  "tax_amount": 713274.34,
  "total_amount": 6200000.00,
  "items": [
    {
      "name": "货物名称",
      "amount": 2566371.68,
      "tax_amount": 333628.32
    }
  ]
}
```

---

## 四、特殊字段说明（枚举映射）

> **本章节内容为通用枚举映射，适用于所有发票类型。**
>
> 详见独立文档：**[00_通用说明_枚举映射.md](./00_通用说明_枚举映射.md)**

本章节包含以下通用映射规则：
- **4.1 查验结果代码映射** (CYJGDM → result_code / error)
- **4.2 发票状态/作废标志映射** (ZFBZ → invoice_status)
- **4.3 特殊票种标志映射** (TSPZBZ → special_invoice_type)
- **4.4 枚举映射示例**

### 快速参考

#### 查验结果代码（CYJGDM）

| 长软代码 | 含义 | 映射到本公司API |
|---|---|---|
| 001 | 查验成功发票一致 | `result_code: "00"` (HTTP 200) |
| 006 | 查验成功发票不一致 | `result_code: "03"` (HTTP 200) |
| 009 | 所查发票不存在 | `result_code: "02"` (HTTP 200) |
| 002-109 | 技术错误/业务阻止 | `error.code` (HTTP 4xx/5xx) |

#### 发票状态（ZFBZ）

| 长软 | 本公司 | 说明 |
|---|---|---|
| 0, 1, N | 0 或 1 | 正常 |
| 2, Y | 2 | 作废 |
| 3 | 3 | 红冲 |
| 7, 8 | 7, 8 | 部分/全额红冲 |

**完整映射规则请查看**: [00_通用说明_枚举映射.md](./00_通用说明_枚举映射.md)

---

## 五、集成注意事项

### 5.1 必填字段对比

**长软API必填 (但本公司API可选)**:
- 无

**本公司API必填 (但长软API可选)**:
- `invoice_code` (发票代码)
- `invoice_status` (发票状态)
- `invoice_number` (发票号码)
- `issue_date` (开票日期)
- `seller_tax_no` (销售方识别号)

### 5.2 字段长度差异

| 字段 | 本公司API | 长软API | 风险评估 |
|---|---|---|---|
| invoice_number | 20 | 10 | ⚠️ 本公司长度更大，需验证 |
| seller_tax_no | 20 | 26 | ⚠️ 长软长度更大，注意截断 |
| buyer_tax_no | 20 | 64 | ⚠️ 长软长度更大，注意截断 |

### 5.3 数据完整性

1. **长软独有字段**（本公司API需考虑是否补充）:
   - `CYCS` (查验次数)
   - `JQBH` (机器编号)
   - `CYSJ` (查验时间)
   - `QDBZ` (清单标志)
   - `HZDK` (汇总代开标志)

2. **本公司独有字段**（可能需要从其他数据源获取）:
   - `proxy_seller_tax_no` / `proxy_seller_name` (代开信息)
   - `void_date` (作废日期)
   - `vehicle_abnormal_flag` (机动车异常标识)
   - 等业务扩展字段

---

## 六、映射示例

### 示例1：基本发票信息

**长软API返回**:
```xml
<BODY>
  <FPDM>6100221130</FPDM>
  <FPHM>07804189</FPHM>
  <KPRQ>20220810</KPRQ>
  <GFMC>潍坊三力本诺化学工业有限公司</GFMC>
  <GFSBH>91370786586090911N</GFSBH>
  <XFMC>西安蓝晓科技新材料股份有限公司</XFMC>
  <XFSBH>91610131726285914J</XFSBH>
  <JE>5486725.66</JE>
  <SE>713274.34</SE>
  <JSHJ>6200000.00</JSHJ>
</BODY>
```

**映射到本公司API**:
```json
{
  "invoice_code": "6100221130",
  "invoice_number": "07804189",
  "issue_date": "2022-08-10",
  "buyer_name": "潍坊三力本诺化学工业有限公司",
  "buyer_tax_no": "91370786586090911N",
  "seller_name": "西安蓝晓科技新材料股份有限公司",
  "seller_tax_no": "91610131726285914J",
  "amount": 5486725.66,
  "tax_amount": 713274.34,
  "total_amount": 6200000.00
}
```

### 示例2：货物明细

**长软API返回**:
```xml
<CHILDLIST>
  <CHILD>
    <HWMC>*其他机械设备*成套树脂尾气处理装置50000m3/h</HWMC>
    <GGXH></GGXH>
    <DW>套</DW>
    <SL>1</SL>
    <DJ>2566371.681415929203540</DJ>
    <JE>2566371.68</JE>
    <SLV>13</SLV>
    <SE>333628.32</SE>
    <SPBM>1099900000000000000</SPBM>
  </CHILD>
</CHILDLIST>
```

**映射到本公司API**:
```json
{
  "items": [
    {
      "sequence_no": 1,
      "name": "*其他机械设备*成套树脂尾气处理装置50000m3/h",
      "specification": "",
      "unit": "套",
      "quantity": "1",
      "unit_price": "2566371.681415929203540",
      "amount": 2566371.68,
      "tax_rate": 0.13,
      "tax_amount": 333628.32,
      "product_code": "1099900000000000000"
    }
  ]
}
```

---

## 七、版本历史

| 版本 | 日期 | 修订内容 | 作者 |
|---|---|---|---|
| v1.1 | 2025-12-29 | 补充完整的枚举映射关系：<br>- 查验结果代码 → result_code/error映射<br>- 作废标志 → invoice_status映射<br>- 特殊票种标志 → special_invoice_type映射<br>- 增加4个枚举映射示例 | Claude |
| v1.0 | 2025-12-29 | 初始版本，创建01增值税专用发票字段映射表 | Claude |

---

## 八、参考文档

1. 本公司API定义: `invoice_verification.apifox.json`
2. 长软API文档: `【长软】发票查验服务调用说明V4.0.16.pdf`
3. 国家税务总局发票查验平台: https://inv-veri.chinatax.gov.cn/

---

**文档结束**
